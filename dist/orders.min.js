!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.Orders=t()}(this,function(){$p.modifiers.push(function(e){var t=e.cat.contracts;t.sql_selection_list_flds=function(e){return"SELECT _t_.ref, _t_.`_deleted`, _t_.is_folder, _t_.id, _t_.name as presentation, _k_.synonym as contract_kind, _m_.synonym as mutual_settlements, _o_.name as organization, _p_.name as partner, case when _t_.ref = '"+e+"' then 0 else 1 end as is_initial_value FROM cat_contracts AS _t_ left outer join cat_organizations as _o_ on _o_.ref = _t_.organization left outer join cat_partners as _p_ on _p_.ref = _t_.owner left outer join enm_mutual_contract_settlements as _m_ on _m_.ref = _t_.mutual_settlements left outer join enm_contract_kinds as _k_ on _k_.ref = _t_.contract_kind %3 %4 LIMIT 300"},t.by_partner_and_org=function(a,n,r){r||(r=e.enm.contract_kinds.СПокупателем);var i=t.find_rows({owner:a,organization:n,contract_kind:r});return i.sort(function(e,t){return e.date>t.date}),i.length?i[0]:t.get()}}),$p.modifiers.push(function(e){var t=e.cat.partners;t.sql_selection_where_flds=function(e){return" OR inn LIKE '"+e+"' OR name_full LIKE '"+e+"' OR name LIKE '"+e+"'"},t._obj_constructor.prototype.__define({addr:{get:function(){return this.contact_information._obj.reduce(function(t,a){return a.kind==e.cat.contact_information_kinds.predefined("ЮрАдресКонтрагента")&&a.presentation?a.presentation:t?t:!a.presentation||a.kind!=e.cat.contact_information_kinds.predefined("ФактАдресКонтрагента")&&a.kind!=e.cat.contact_information_kinds.predefined("ПочтовыйАдресКонтрагента")?void 0:a.presentation},"")}},phone:{get:function(){return this.contact_information._obj.reduce(function(t,a){return a.kind==e.cat.contact_information_kinds.predefined("ТелефонКонтрагента")&&a.presentation?a.presentation:t?t:a.kind==e.cat.contact_information_kinds.predefined("ТелефонКонтрагентаМобильный")&&a.presentation?a.presentation:void 0},"")}},long_presentation:{get:function(){var e=this.name_full||this.name,t=this.addr,a=this.phone;return this.inn&&(e+=", ИНН"+this.inn),this.kpp&&(e+=", КПП"+this.kpp),t&&(e+=", "+t),a&&(e+=", "+a),e}}})}),$p.modifiers.push(function(e){e.cat.users_acl.__define({load_array:{value:function(t,a){var n,r,i,o=[];for(var s in t){if(n=e.utils.fix_guid(t[s]),i=t[s].acl,i&&delete t[s].acl,(r=this.by_ref[n])?(r.is_new()||a)&&(r._mixin(t[s]),r._set_loaded()):(r=new this._obj_constructor(t[s],this),a&&r._set_loaded()),i&&!r._acl){var l={};for(var s in i){l.__define(s,{value:{},writable:!1});for(var c in i[s])l[s].__define(c,{value:i[s][c],writable:!1})}r.__define({_acl:{value:l,writable:!1}})}o.push(r)}return o}}}),e.cat.users_acl._obj_constructor.prototype.__define({role_available:{value:function(e){return this.acl_objs._obj.some(function(t){return t.type==e})}},partners_uids:{get:function(){var t=[];return this.acl_objs.each(function(a){a.acl_obj instanceof e.cat.partners._obj_constructor&&t.push(a.acl_obj.ref)}),t}}})}),$p.modifiers.push(function(e){e.on({pouch_load_data_loaded:function a(){e.off(a),e.cch.predefined_elmnts.pouch_find_rows({_raw:!0,_top:500,_skip:0}).then(function(t){var a={};t.forEach(function(t){if(t.is_folder&&t.synonym){var n=t._id.split("|")[1];a[n]=t.synonym,e.job_prm.__define(t.synonym,{value:{}})}}),t.forEach(function(t){if(!t.is_folder&&t.synonym&&a[t.parent]&&!e.job_prm[a[t.parent]][t.synonym]){var n,r;t.type.is_ref&&(r=t.type.types[0].split("."),n=e[r[0]][r[1]]),t.list==-1?e.job_prm[a[t.parent]].__define(t.synonym,{value:function(){var e={};return t.elmnts.forEach(function(t){e[t.elm]=n?n.get(t.value,!1):t.value}),e}()}):t.list?e.job_prm[a[t.parent]].__define(t.synonym,{value:t.elmnts.map(function(e){return n?n.get(e.value,!1):e.value})}):(e.job_prm[a[t.parent]].hasOwnProperty(t.synonym)&&delete e.job_prm[a[t.parent]][t.synonym],e.job_prm[a[t.parent]].__define(t.synonym,{value:n?n.get(t.value,!1):t.value,configurable:!0}))}})}).then(function(){setTimeout(function(){e.eve.callEvent("predefined_elmnts_inited")},100)})}});var t=e.cch.predefined_elmnts;delete t._obj_constructor.prototype.value,t._obj_constructor.prototype.__define({value:{get:function(){var t,a=this.type,n=this._obj?this._obj.value:"";return this._obj.is_folder?"":"object"==typeof n?n:a.is_ref?a.digits&&"number"==typeof n?n:a.hasOwnProperty("str_len")&&!e.utils.is_guid(n)?n:(t=e.md.value_mgr(this._obj,"value",a))?e.utils.is_data_mgr(t)?t.get(n,!1):e.utils.fetch_type(n,t):n?(console.log(["value",a,this._obj]),null):this.characteristic.clr:a.date_part?e.utils.fix_date(this._obj.value,!0):a.digits?e.utils.fix_number(this._obj.value,!a.hasOwnProperty("str_len")):"boolean"==a.types[0]?e.utils.fix_boolean(this._obj.value):this._obj.value||""},set:function(t){this._obj.value!==t&&(Object.getNotifier(this).notify({type:"update",name:"value",oldValue:this._obj.value}),this._obj.value=e.utils.is_data_obj(t)?t.ref:t,this._data._modified=!0)}}}),t.form_obj=function(e,t){var a,n;return this.constructor.prototype.form_obj.call(this,e,t).then(function(e){if(e)return a=e.o,n=e.wnd,e})}}),$p.modifiers.push(function(e){var t=e.cch.properties;t.check_mandatory=function(t,a){var n,r;for(n in t)if(r=t[n],r.param.mandatory&&(!r.value||r.value.empty()))return e.msg.show_msg({type:"alert-error",text:e.msg.bld_empty_param+r.param.presentation,title:a||e.msg.bld_title}),!0},t.slist=function(t,a){var n,r,i,o=[],s=this.get(t);if(s&&s.type.is_ref)for(n in s.type.types)s.type.types[n].indexOf(".")>-1&&(r=s.type.types[n].split("."),i=e[r[0]][r[1]],i&&(a&&(a.mgr=i),"enm.open_directions"==i.class_name?i.get_option_list().forEach(function(t){t.value&&t.value!=e.enm.tso.folding&&o.push(t)}):i.class_name.indexOf("enm.")==-1&&i.metadata().has_owners?i.find_rows({owner:t},function(e){o.push({value:e.ref,text:e.presentation})}):o=i.get_option_list()));return o}}),$p.modifiers.push(function(e){var t=e.doc.buyers_order;t.on("after_create",function(t){var a=e.current_acl.acl_objs,n=this;return a.find_rows({by_default:!0,type:e.cat.organizations.metadata().obj_presentation||e.cat.organizations.metadata().name},function(e){return n.organization=e.acl_obj,!1}),a.find_rows({by_default:!0,type:e.cat.divisions.metadata().obj_presentation||e.cat.divisions.metadata().name},function(e){return n.department=e.acl_obj,!1}),a.find_rows({by_default:!0,type:e.cat.partners.metadata().obj_presentation||e.cat.partners.metadata().name},function(e){return n.partner=e.acl_obj,!1}),n.contract=e.cat.contracts.by_partner_and_org(n.partner,n.organization),n.manager=e.current_user,n.obj_delivery_state=e.enm.obj_delivery_states.Черновик,n.new_number_doc()}),t.on("before_save",function(t){if(this.posted){if(this.obj_delivery_state==e.enm.obj_delivery_states.Отклонен||this.obj_delivery_state==e.enm.obj_delivery_states.Отозван||this.obj_delivery_state==e.enm.obj_delivery_states.Шаблон)return e.msg.show_msg({type:"alert-warning",text:"Нельзя провести заказ со статусом<br/>'Отклонён', 'Отозван' или 'Шаблон'",title:this.presentation}),!1;this.obj_delivery_state!=e.enm.obj_delivery_states.Подтвержден&&(this.obj_delivery_state=e.enm.obj_delivery_states.Подтвержден)}else this.obj_delivery_state==e.enm.obj_delivery_states.Подтвержден&&(this.obj_delivery_state=e.enm.obj_delivery_states.Отправлен);this.doc_amount=this.goods.aggregate([],["amount"]).round(2)+this.services.aggregate([],["amount"]).round(2),this._obj.partner_name=this.partner.name}),t.on("value_change",function(t){"organization"==t.field&&this.contract.organization!=t.value?this.contract=e.cat.contracts.by_partner_and_org(this.partner,t.value):"partner"==t.field&&this.contract.owner!=t.value?this.contract=e.cat.contracts.by_partner_and_org(t.value,this.organization):"goods"==t.tabular_section&&("nom"==t.field||"characteristic"==t.field||"price"!=t.field&&"price_internal"!=t.field&&"quantity"!=t.field&&"discount_percent"!=t.field&&"discount_percent_internal"!=t.field||(t.row[t.field]=t.value,t.row.amount=(t.row.price*((100-t.row.discount_percent)/100)*t.row.quantity).round(2),this.doc_amount=this.goods.aggregate([],["amount"]).round(2)+this.services.aggregate([],["amount"]).round(2)))}),t._obj_constructor.prototype.__define({doc_currency:{get:function(){var t=this.contract.settlements_currency;return t.empty()?e.job_prm.pricing.main_currency:t}},print_data:{get:function(){var t=this.organizational_unit&&!this.organizational_unit.empty()&&this.organizational_unit._manager==cat.organization_bank_accounts?this.organizational_unit:this.organization.main_bank_account,a=[],n={"АдресДоставки":this.shipping_address,"ВалютаДокумента":this.doc_currency.presentation,"ДатаЗаказаФорматD":e.moment(this.date).format("L"),"ДатаЗаказаФорматDD":e.moment(this.date).format("LL"),"ДатаТекущаяФорматD":e.moment().format("L"),"ДатаТекущаяФорматDD":e.moment().format("LL"),"ДоговорДатаФорматD":e.moment(this.contract.date.valueOf()==e.utils.blank.date.valueOf()?this.date:this.contract.date).format("L"),"ДоговорДатаФорматDD":e.moment(this.contract.date.valueOf()==e.utils.blank.date.valueOf()?this.date:this.contract.date).format("LL"),"ДоговорНомер":this.contract.number_doc?this.contract.number_doc:this.number_doc,"ДоговорСрокДействия":e.moment(this.contract.validity).format("L"),"ЗаказНомер":this.number_doc,"Контрагент":this.partner.presentation,"КонтрагентОписание":this.partner.long_presentation,"КонтрагентДокумент":"","КонтрагентКЛДолжность":"","КонтрагентКЛДолжностьРП":"","КонтрагентКЛИмя":"","КонтрагентКЛИмяРП":"","КонтрагентКЛК":"","КонтрагентКЛОснованиеРП":"","КонтрагентКЛОтчество":"","КонтрагентКЛОтчествоРП":"","КонтрагентКЛФамилия":"","КонтрагентКЛФамилияРП":"","КонтрагентЮрФизЛицо":"","КратностьВзаиморасчетов":this.settlements_multiplicity,"КурсВзаиморасчетов":this.settlements_course,"ЛистКомплектацииГруппы":"","ЛистКомплектацииСтроки":"","Организация":this.organization.presentation,"ОрганизацияГород":this.organization.contact_information._obj.reduce(function(e,t){return e||t.city},"")||"Москва","ОрганизацияАдрес":this.organization.contact_information._obj.reduce(function(t,a){return a.kind==e.cat.contact_information_kinds.predefined("ЮрАдресОрганизации")&&a.presentation?a.presentation:t?t:!a.presentation||a.kind!=e.cat.contact_information_kinds.predefined("ФактАдресОрганизации")&&a.kind!=e.cat.contact_information_kinds.predefined("ПочтовыйАдресОрганизации")?void 0:a.presentation},""),"ОрганизацияТелефон":this.organization.contact_information._obj.reduce(function(t,a){return a.kind==e.cat.contact_information_kinds.predefined("ТелефонОрганизации")&&a.presentation?a.presentation:t?t:a.kind==e.cat.contact_information_kinds.predefined("ФаксОрганизации")&&a.presentation?a.presentation:void 0},""),"ОрганизацияБанкБИК":t.bank.id,"ОрганизацияБанкГород":t.bank.city,"ОрганизацияБанкКоррСчет":t.bank.correspondent_account,"ОрганизацияБанкНаименование":t.bank.name,"ОрганизацияБанкНомерСчета":t.account_number,"ОрганизацияИндивидуальныйПредприниматель":this.organization.individual_entrepreneur.presentation,"ОрганизацияИНН":this.organization.inn,"ОрганизацияКПП":this.organization.kpp,"ОрганизацияСвидетельствоДатаВыдачи":this.organization.certificate_date_issue,"ОрганизацияСвидетельствоКодОргана":this.organization.certificate_authority_code,"ОрганизацияСвидетельствоНаименованиеОргана":this.organization.certificate_authority_name,"ОрганизацияСвидетельствоСерияНомер":this.organization.certificate_series_number,"ОрганизацияЮрФизЛицо":this.organization.individual_legal.presentation,"ПродукцияЭскизы":{},"Проект":this.project.presentation,"СистемыПрофилей":this.sys_profile,"СистемыФурнитуры":this.sys_furn,"Сотрудник":this.manager.presentation,"СотрудникДолжность":this.manager.individual_person.Должность||"менеджер","СотрудникДолжностьРП":this.manager.individual_person.ДолжностьРП,"СотрудникИмя":this.manager.individual_person.Имя,"СотрудникИмяРП":this.manager.individual_person.ИмяРП,"СотрудникОснованиеРП":this.manager.individual_person.ОснованиеРП,"СотрудникОтчество":this.manager.individual_person.Отчество,"СотрудникОтчествоРП":this.manager.individual_person.ОтчествоРП,"СотрудникФамилия":this.manager.individual_person.Фамилия,"СотрудникФамилияРП":this.manager.individual_person.ФамилияРП,"СотрудникФИО":this.manager.individual_person.Фамилия+(this.manager.individual_person.Имя?" "+this.manager.individual_person.Имя[1].toUpperCase()+".":"")+(this.manager.individual_person.Отчество?" "+this.manager.individual_person.Отчество[1].toUpperCase()+".":""),"СотрудникФИОРП":this.manager.individual_person.ФамилияРП+" "+this.manager.individual_person.ИмяРП+" "+this.manager.individual_person.ОтчествоРП,"СуммаДокумента":this.doc_amount.toFixed(2),"СуммаДокументаПрописью":this.doc_amount.in_words(),"СуммаДокументаБезСкидки":this.goods._obj.reduce(function(e,t){return e+t.quantity*t.price},0).toFixed(2)+this.service._obj.reduce(function(e,t){return e+t.quantity*t.price},0).toFixed(2),"СуммаСкидки":this.goods._obj.reduce(function(e,t){return e+t.discount},0).toFixed(2)+this.servise._obj.reduce(function(e,t){return e+t.discount},0).toFixed(2),"СуммаНДС":this.goods._obj.reduce(function(e,t){return e+t.vat_amount},0).toFixed(2)+this.servise._obj.reduce(function(e,t){return e+t.vat_amount},0).toFixed(2),"ТекстНДС":this.vat_consider?this.vat_included?"В том числе НДС 18%":"НДС 18% (сверху)":"Без НДС","ТелефонПоАдресуДоставки":this.phone,"СуммаВключаетНДС":this.contract.vat_included,"УчитыватьНДС":this.contract.vat_consider,"ВсегоНаименований":this.goods.count()+this.service.count(),"ВсегоИзделий":0,"ВсегоПлощадьИзделий":0};this.extra_fields.forEach(function(e){n["Свойство"+e.property.name.replace(/\s/g,"")]=e.value.presentation||e.value}),this.shipping_address?n.МонтажДоставкаСамовывоз="Монтаж по адресу: "+this.shipping_address:n.МонтажДоставкаСамовывоз="Самовывоз";for(var r in this.organization._attachments)if(r.indexOf("logo")!=-1){a.push(this.organization.get_attachment(r).then(function(t){return e.utils.blob_as_text(t,t.type.indexOf("svg")==-1?"data_url":"")}).then(function(e){n.ОрганизацияЛоготип=e})["catch"](e.record_log));break}return(a.length?Promise.all(a):Promise.resolve([])).then(function(){if(!window.QRCode)return new Promise(function(t,a){e.load_script("lib/qrcodejs/qrcode.js","script",t)})}).then(function(){var e=document.createElement("SVG");e.innerHTML="<g />";new QRCode(e,{text:"http://www.oknosoft.ru/zd/",width:100,height:100,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H,useSVG:!0});return n.qrcode=e.innerHTML,n})}},row_description:{value:function(e){var t=e.characteristic,a={"НомерСтроки":e.row,"Количество":e.quantity,"Ед":e.unit.name||"шт","Цвет":t.clr.name,"Размеры":e.len+"x"+e.width+", "+e.s+"м²","Номенклатура":e.nom.name_full||e.nom.name,"Характеристика":t.name,"Заполнения":"","Цена":e.price,"ЦенаВнутр":e.price_internal,"СкидкаПроцент":e.discount_percent,"СкидкаПроцентВнутр":e.discount_percent_internal,"Скидка":e.discount,"Сумма":e.amount,"СуммаВнутр":e.amount_internal};return t.glasses.forEach(function(e){a.Заполнения.indexOf(e.nom.name)==-1&&(a.Заполнения&&(a.Заполнения+=", "),a.Заполнения+=e.nom.name)}),a}}})}),$p.modifiers.push(function(e){var t=e.doc.buyers_order;t.form_list=function(a,n){function r(t){function a(){switch(t){case"execution":e.doc.buyers_order.rep_invoice_execution(l);break;case"plan":case"underway":case"manufactured":case"executed":e.doc.buyers_order.rep_planing(l,t)}}s.cells("report").setActive(),l?l._online&&a():l=new e.HandsontableDocument(s.cells("report"),{}).then(function(e){return e._online?void a():l=null})}n||(n={hide_header:!0,date_from:new Date((new Date).getFullYear().toFixed()+"-01-01"),date_till:new Date((new Date).getFullYear().toFixed()+"-12-31"),on_new:function(a){e.iface.set_hash(t.class_name,a.ref)},on_edit:function(t,a){e.iface.set_hash(t.class_name,a)}});var i=a.attachLayout({pattern:"2U",cells:[{id:"a",text:"Фильтр",collapsed_text:"Фильтр",width:180},{id:"b",text:"Заказы",header:!1}],offsets:{top:0,right:0,bottom:0,left:0}}),o=i.cells("a").attachTree(),s=i.cells("b").attachCarousel({keys:!1,touch_scroll:!1,offset_left:0,offset_top:0,offset_item:0});s.hideControls(),s.addCell("list"),s.addCell("report"),s.conf.anim_step=200,s.conf.anim_slide="left 0.1s";var l,c=t.form_selection(s.cells("list"),n),_={},d={};return _.__define({value:{get:function(){switch(o.getSelectedItemId()){case"draft":case"sent":case"declined":case"confirmed":case"service":case"complaints":case"template":case"zarchive":return"doc/doc_buyers_order_date";case"execution":case"plan":case"underway":case"manufactured":case"executed":case"all":return""}}}}),d.__define({value:{get:function(){var e,t;switch(t=o.getSelectedItemId()){case"draft":case"sent":case"declined":case"confirmed":case"service":case"complaints":case"template":case"zarchive":e=t;break;case"execution":case"plan":case"underway":case"manufactured":case"executed":case"all":return""}var a=c.elmnts.filter.get_filter(!0);return{startkey:[e,a.date_from.getFullYear(),a.date_from.getMonth()+1,a.date_from.getDate()],endkey:[e,a.date_till.getFullYear(),a.date_till.getMonth()+1,a.date_till.getDate()],_drop_date:!0,_order_by:!0,_search:a.filter.toLowerCase()}}}}),c.elmnts.filter.custom_selection._view=_,c.elmnts.filter.custom_selection._key=d,c.elmnts.svgs=new e.iface.OSvgs(e.doc.buyers_order,c,c.elmnts.status_bar),c.elmnts.grid.attachEvent("onRowSelect",function(e){c.elmnts.svgs.reload(e)}),o.enableTreeImages(!1),o.parse(e.injected_data["tree_filteres.xml"]),o.attachEvent("onSelect",function(e){switch(e){case"draft":case"sent":case"declined":case"confirmed":case"service":case"complaints":case"template":case"zarchive":case"all":return s.cells("list").setActive(),void c.elmnts.filter.call_event()}r(e)}),c}}),$p.modifiers.push(function(e){var t,a=e.doc.buyers_order;a.form_obj=function(n,r){function i(t){switch(t){case"btn_sent":c("sent");break;case"btn_save":c("save");break;case"btn_save_close":c("close");break;case"btn_retrieve":c("retrieve");break;case"btn_post":c("post");break;case"btn_unpost":c("unpost");break;case"btn_close":u.close();break;case"btn_add_builder":open_builder(!0);break;case"btn_add_product":e.dp.buyers_order.form_product_list(u,process_add_product);break;case"btn_add_material":add_material();break;case"btn_edit":open_builder();break;case"btn_spec":open_spec();break;case"btn_discount":break;case"btn_calendar":o();break;case"btn_go_connection":s()}"prn_"==t.substr(0,4)&&a.print(p,t,u)}function o(){e.msg.show_not_implemented()}function s(){e.msg.show_not_implemented()}function l(){u.elmnts.discount||(u.elmnts.discount=u.elmnts.discount_pop.attachForm([{type:"fieldset",name:"discounts",label:"Скидки по группам",width:220,list:[{type:"settings",position:"label-left",labelWidth:100,inputWidth:50},{type:"input",label:"На продукцию",name:"production",numberFormat:["0.0 %","","."]},{type:"input",label:"На аксессуары",name:"accessories",numberFormat:["0.0 %","","."]},{type:"input",label:"На услуги",name:"services",numberFormat:["0.0 %","","."]}]},{type:"button",name:"btn_discounts",value:"Ок",tooltip:"Установить скидки"}]),u.elmnts.discount.setItemValue("production",0),u.elmnts.discount.setItemValue("accessories",0),u.elmnts.discount.setItemValue("services",0),u.elmnts.discount.attachEvent("onButtonClick",function(e){u.progressOn()}))}function c(t){function a(a){u.elmnts.ro||(p.note=u.elmnts.cell_note.cell.querySelector("textarea").value.replace(/&nbsp;/g," ").replace(/<.*?>/g,"").replace(/&.{2,6};/g,""),u.elmnts.pg_left.selectRow(0)),p.save(a).then(function(){"sent"==t||"close"==t?u.close():(u.set_text(),d())})["catch"](function(t){e.record_log(t)})}"sent"==t?dhtmlx.confirm({title:e.msg.order_sent_title,text:e.msg.order_sent_message,cancel:e.msg.cancel,callback:function(t){t&&(p.obj_delivery_state=e.enm.obj_delivery_states.Отправлен,a())}}):"retrieve"==t?(p.obj_delivery_state=e.enm.obj_delivery_states.Отозван,a()):"save"==t||"close"==t?a():"post"==t?a(!0):"unpost"==t&&a(!1)}function _(){return["vault","vault_pop","discount","discount_pop"].forEach(function(e){u&&u.elmnts&&u.elmnts[e]&&u.elmnts[e].unload&&u.elmnts[e].unload()}),A.forEach(function(t){e.eve.detachEvent(t)}),"function"==typeof m&&m(),!0}function d(){var t,a,n=e.enm.obj_delivery_states.Черновик,r=e.enm.obj_delivery_states.Отозван;u.elmnts.pg_right.cells("vat_consider",1).setDisabled(!0),u.elmnts.pg_right.cells("vat_included",1).setDisabled(!0),u.elmnts.ro=!1,p.obj_delivery_state==e.enm.obj_delivery_states.Шаблон?u.elmnts.ro=!e.current_acl.role_available("ИзменениеТехнологическойНСИ"):p.posted||p._deleted?u.elmnts.ro=!e.current_acl.role_available("СогласованиеРасчетовЗаказов"):u.elmnts.ro||p.obj_delivery_state.empty()||(u.elmnts.ro=p.obj_delivery_state!=n&&p.obj_delivery_state!=r),t=!p._deleted&&(p.obj_delivery_state==e.enm.obj_delivery_states.Отправлен||p.obj_delivery_state==e.enm.obj_delivery_states.Отклонен),u.elmnts.grids.production.setEditable(!u.elmnts.ro),u.elmnts.grids.planning.setEditable(!u.elmnts.ro),u.elmnts.pg_left.setEditable(!u.elmnts.ro),u.elmnts.pg_right.setEditable(!u.elmnts.ro),e.current_acl.role_available("СогласованиеРасчетовЗаказов")||(u.elmnts.frm_toolbar.hideItem("btn_post"),u.elmnts.frm_toolbar.hideItem("btn_unpost")),u.elmnts.ro?(u.elmnts.frm_toolbar.disableItem("btn_sent"),u.elmnts.frm_toolbar.disableItem("btn_save"),a=u.elmnts.tabs.tab_production.getAttachedToolbar(),a.forEachItem(function(e){a.disableItem(e)}),a=u.elmnts.tabs.tab_planning.getAttachedToolbar(),a.forEachItem(function(e){a.disableItem(e)})):(p.obj_delivery_state==e.enm.obj_delivery_states.Шаблон?u.elmnts.frm_toolbar.disableItem("btn_sent"):u.elmnts.frm_toolbar.enableItem("btn_sent"),u.elmnts.frm_toolbar.enableItem("btn_save"),a=u.elmnts.tabs.tab_production.getAttachedToolbar(),a.forEachItem(function(e){a.enableItem(e)}),a=u.elmnts.tabs.tab_planning.getAttachedToolbar(),a.forEachItem(function(e){a.enableItem(e)})),t?u.elmnts.frm_toolbar.enableListOption("bs_more","btn_retrieve"):u.elmnts.frm_toolbar.disableListOption("bs_more","btn_retrieve")}var p,u,A=[],m=r.on_close;return t||(!function(t){e.wsql.get_user_param("hide_price_dealer")?(t.headers="№,Номенклатура,Характеристика,Комментарий,Штук,Длина,Высота,Площадь,Колич.,Ед,Скидка,Цена,Сумма,Скидка&nbsp;дил,Цена&nbsp;дил,Сумма&nbsp;дил",t.widths="40,200,*,220,0,70,70,70,70,40,70,70,70,0,0,0",t.min_widths="30,200,220,150,0,70,40,70,70,70,70,70,70,0,0,0"):e.wsql.get_user_param("hide_price_manufacturer")?(t.headers="№,Номенклатура,Характеристика,Комментарий,Штук,Длина,Высота,Площадь,Колич.,Ед,Скидка&nbsp;пост,Цена&nbsp;пост,Сумма&nbsp;пост,Скидка,Цена,Сумма",t.widths="40,200,*,220,0,70,70,70,70,40,0,0,0,70,70,70",t.min_widths="30,200,220,150,0,70,40,70,70,70,0,0,0,70,70,70"):(t.headers="№,Номенклатура,Характеристика,Комментарий,Штук,Длина,Высота,Площадь,Колич.,Ед,Скидка&nbsp;пост,Цена&nbsp;пост,Сумма&nbsp;пост,Скидка&nbsp;дил,Цена&nbsp;дил,Сумма&nbsp;дил",t.widths="40,200,*,220,0,70,70,70,70,40,70,70,70,70,70,70",t.min_widths="30,200,220,150,0,70,40,70,70,70,70,70,70,70,70,70"),e.current_acl.role_available("СогласованиеРасчетовЗаказов")||e.current_acl.role_available("РедактированиеСкидок")?t.types="cntr,ref,ref,txt,ro,calck,calck,calck,calck,ref,calck,calck,ro,calck,calck,ro":t.types="cntr,ref,ref,txt,ro,calck,calck,calck,calck,ref,ro,ro,ro,calck,calck,ro"}(e.doc.buyers_order.metadata().form.obj.tabular_sections.production),t=!0),r.draw_tabular_sections=function(t,a,n){var r=[];t.production.each(function(t){!e.utils.is_empty_guid(t._obj.characteristic)&&t.characteristic.is_new()&&r.push(t._obj.characteristic)}),e.cat.characteristics.pouch_load_array(r).then(function(){n("goods");var e=a.elmnts.tabs.tab_production.getAttachedToolbar();e.addSpacer("btn_delete"),e.attachEvent("onclick",i),n("planning"),a.elmnts.discount_pop=new dhtmlXPopup({toolbar:e,id:"btn_discount"}),a.elmnts.discount_pop.attachEvent("onShow",l),setTimeout(d,50)})},r.draw_pg_header=function(t,a){function n(){setTimeout(function(){a.elmnts.layout_header.setSizes&&(a.elmnts.layout_header.setSizes(),a.elmnts.pg_left.objBox.style.width="100%",a.elmnts.pg_right.objBox.style.width="100%")},200)}a.elmnts.layout_header=a.elmnts.tabs.tab_header.attachLayout("3U"),a.elmnts.layout_header.attachEvent("onResizeFinish",n),a.elmnts.layout_header.attachEvent("onPanelResizeFinish",n),a.elmnts.cell_left=a.elmnts.layout_header.cells("a"),a.elmnts.cell_left.hideHeader(),a.elmnts.pg_left=a.elmnts.cell_left.attachHeadFields({obj:t,pwnd:a,read_only:a.elmnts.ro,oxml:{" ":[{id:"number_doc",path:"o.number_doc",synonym:"Номер",type:"ro",txt:t.number_doc},{id:"date",path:"o.date",synonym:"Дата",type:"ro",txt:e.moment(t.date).format(e.moment._masks.date_time)},"number_internal"],"Контактная информация":["partner","client_of_dealer","phone",{id:"shipping_address",path:"o.shipping_address",synonym:"Адрес доставки",type:"addr",txt:t.shipping_address}],"Дополнительные реквизиты":[{id:"obj_delivery_state",path:"o.obj_delivery_state",synonym:"Состояние транспорта",type:"ro",txt:t.obj_delivery_state.presentation},"category"]}}),a.elmnts.cell_right=a.elmnts.layout_header.cells("b"),a.elmnts.cell_right.hideHeader(),a.elmnts.pg_right=a.elmnts.cell_right.attachHeadFields({obj:t,pwnd:a,read_only:a.elmnts.ro,oxml:{"Налоги":["vat_consider","vat_included"],"Аналитика":["project",{id:"organization",path:"o.organization",synonym:"Организация",type:"refc",txt:t.organization.presentation},"contract","organizational_unit","department"],"Итоги":[{id:"doc_currency",path:"o.doc_currency",synonym:"Валюта документа",type:"ro",txt:t.doc_currency.presentation},{id:"doc_amount",path:"o.doc_amount",synonym:"Сумма",type:"ron",txt:t.doc_amount},{id:"amount_internal",path:"o.amount_internal",synonym:"Сумма внутр",type:"ron",txt:t.amount_internal}]}}),a.elmnts.cell_note=a.elmnts.layout_header.cells("c"),a.elmnts.cell_note.hideHeader(),a.elmnts.cell_note.setHeight(100),a.elmnts.cell_note.attachHTMLString("<textarea class='textarea_editor'>"+t.note+"</textarea>")},r.toolbar_struct=e.injected_data["toolbar_buyers_order_obj.xml"],r.toolbar_click=i,r.on_close=_,this.constructor.prototype.form_obj.call(this,n,r).then(function(e){if(e)return p=e.o,u=e.wnd,e})}}),$p.modifiers.push(function(e){e.doc.buyers_order.rep_invoice_execution=function(t){var a={reduce:!0,limit:1e4,group:!0,group_level:3},n={data:[],readOnly:!0,colWidths:[180,180,200,100,100,100,100,100],colHeaders:["Контрагент","Организация","Заказ","Сумма","Оплачено","Долг","Отгружено","Отгрузить"],columns:[{type:"text"},{type:"text"},{type:"text"},{type:"numeric",format:"0 0.00"},{type:"numeric",format:"0 0.00"},{type:"numeric",format:"0 0.00"},{type:"numeric",format:"0 0.00"},{type:"numeric",format:"0 0.00"}],wordWrap:!1};return e.current_acl.role_available("СогласованиеРасчетовЗаказов")||(a.startkey=[e.current_acl.partners_uids[0],""],a.endkey=[e.current_acl.partners_uids[0],"￿"]),e.wsql.pouch.remote.doc.query("server/invoice_execution",a).then(function(a){var r={invoice:0,pay:0,total_pay:0,shipment:0,total_shipment:0};return a.rows&&(a.rows.forEach(function(t){(t.value.total_pay||t.value.total_shipment)&&(n.data.push([e.cat.partners.get(t.key[0]).presentation,e.cat.organizations.get(t.key[1]).presentation,t.key[2],t.value.invoice,t.value.pay,t.value.total_pay,t.value.shipment,t.value.total_shipment]),r.invoice+=t.value.invoice,r.pay+=t.value.pay,r.total_pay+=t.value.total_pay,r.shipment+=t.value.shipment,r.total_shipment+=t.value.total_shipment)}),n.data.push(["Итого:","","",r.invoice,r.pay,r.total_pay,r.shipment,r.total_shipment]),n.mergeCells=[{row:n.data.length-1,col:0,rowspan:1,colspan:3}]),t.requery(n),n})}}),$p.modifiers.push(function(e){function t(e){function t(){return e.doc.nom_prices_setup.pouch_db.query("doc/doc_nom_prices_setup_slice_last",{limit:1e3,include_docs:!1,startkey:[""],endkey:["￿"]}).then(function(t){t.rows.forEach(function(t){var a=e.cat.nom.get(t.key[0],!1,!0);a&&a._data&&(a._data._price||(a._data._price={}),a._data._price[t.key[1]]||(a._data._price[t.key[1]]={}),a._data._price[t.key[1]][t.key[2]]||(a._data._price[t.key[1]][t.key[2]]=[]),a._data._price[t.key[1]][t.key[2]].push({date:new Date(t.value.date),price:t.value.price,currency:e.cat.currencies.get(t.value.currency)}))})})}this.from_currency_to_currency=function(t,a,n,r){if(r&&!r.empty()||(r=e.job_prm.pricing.main_currency),!n||n==r)return t;a||(a=new Date),this.cource_sql||(this.cource_sql=e.wsql.alasql.compile("select top 1 * from `ireg_currency_courses` where `currency` = ? and `period` <= ? order by `date` desc"));var i,o={course:1,multiplicity:1},s={course:1,multiplicity:1};return n!=e.job_prm.pricing.main_currency&&(i=this.cource_sql([n.ref,a]),i.length&&(o=i[0])),r!=e.job_prm.pricing.main_currency&&(i=this.cource_sql([r.ref,a]),i.length&&(s=i[0])),t*o.course/o.multiplicity*s.multiplicity/s.course},e.on({predefined_elmnts_inited:function a(){e.off(a),t()},pouch_change:function(t,a){t!=e.doc.nom_prices_setup.cachable}})}e.pricing=new t(e),e.cat.nom._obj_constructor.prototype.__define({_price:{value:function(t){t||(t={}),t.price_type?e.utils.is_data_obj(t.price_type)&&(t.price_type=t.price_type.ref):t.price_type=e.job_prm.pricing.price_type_sale,t.characteristic?e.utils.is_data_obj(t.characteristic)&&(t.characteristic=t.characteristic.ref):t.characteristic=e.utils.blank.guid,t.date||(t.date=new Date);var a,n=0,r=e.utils.blank.date;return this._data._price&&(this._data._price[t.characteristic]?this._data._price[t.characteristic][t.price_type]&&this._data._price[t.characteristic][t.price_type].forEach(function(e){e.date>r&&e.date<=t.date&&(n=e.price,a=e.currency)}):t.characteristic!=e.utils.blank.guid&&this._data._price[e.utils.blank.guid]&&this._data._price[e.utils.blank.guid][t.price_type]&&this._data._price[e.utils.blank.guid][t.price_type].forEach(function(e){e.date>r&&e.date<=t.date&&(n=e.price,a=e.currency)})),e.pricing.from_currency_to_currency(n,t.date,a,t.currency)}}})}),$p.injected_data._mixin({"view_about.html":'<div class="md_column1300">\r\n    <h1><i class="fa fa-info-circle"></i> Заказы онлайн</h1>\r\n    <p>Заказы онлайн - это веб-приложение на базе фреймворка <a href="http://www.oknosoft.ru/metadata/" target="_blank">Metadata.js</a><br />\r\n        Исходный код и документация доступны на <a href="https://github.com/oknosoft/order-online" target="_blank">GitHub <i class="fa fa-github-alt"></i></a>.<br />\r\n    </p>\r\n\r\n    <h3>Назначение и возможности</h3>\r\n    <ul>\r\n        <li>Создание и редактирование документов <i>Заказ покупателя</i></li>\r\n        <li>Фоновая синхронизация заказов, цен и номенклатуры с ИБ 1С</li>\r\n        <li>Гибкая настройка видимости и доступности объектов и реквизитов для групп пользователей</li>\r\n        <li>Формирование печатных форм счетов и заказов</li>\r\n        <li>Формирование отчетов об оплате и отгрузке по заказам</li>\r\n        <li>Поддержка автономной работы при отсутствии доступа в Интернет и прозрачного обмена с сервером при возобновлении соединения</li>\r\n    </ul>\r\n\r\n    <p>Использованы следующие библиотеки и инструменты:</p>\r\n\r\n    <h3>Серверная часть</h3>\r\n    <ul>\r\n        <li><a href="http://couchdb.apache.org/" target="_blank">couchDB</a>, NoSQL база данных с поддержкой master-master репликации</li>\r\n        <li><a href="http://nginx.org/ru/" target="_blank">nginx</a>, высокопроизводительный HTTP-сервер</li>\r\n        <li><a href="http://1c-dn.com/1c_enterprise/" target="_blank">1c_enterprise</a>, ORM сервер 1С:Предприятие</li>\r\n    </ul>\r\n\r\n    <h3>Управление данными в памяти браузера</h3>\r\n    <ul>\r\n        <li><a href="https://pouchdb.com/" target="_blank">pouchDB</a>, клиентская NoSQL база данных с поддержкой автономной работы и репликации с CouchDB</li>\r\n        <li><a href="https://github.com/agershun/alasql" target="_blank">alaSQL</a>, база данных SQL для браузера и Node.js с поддержкой как традиционных реляционных таблиц, так и вложенных JSON данных (NoSQL)</li>\r\n        <li><a href="https://github.com/SheetJS/js-xlsx" target="_blank">xlsx</a>, библиотека для чтения и записи XLSX / XLSM / XLSB / XLS / ODS в браузере</li>\r\n    </ul>\r\n\r\n    <h3>UI библиотеки и компоненты интерфейса</h3>\r\n    <ul>\r\n        <li><a href="http://dhtmlx.com/" target="_blank">dhtmlx</a>, кроссбраузерная библиотека javascript для построения современных веб и мобильных приложений</li>\r\n        <li><a href="https://handsontable.com/" target="_blank">handsontable</a>, компонент для отображения и редактирования табличных данных</li>\r\n        <li><a href="https://github.com/eligrey/FileSaver.js" target="_blank">filesaver.js</a>, HTML5 реализация метода saveAs</li>\r\n        <li><a href="http://momentjs.com/" target="_blank">moment.js</a>, библиотека форматирования интервалов и дат</li>\r\n    </ul>\r\n\r\n    <h3>Графика</h3>\r\n    <ul>\r\n        <li><a href="https://fortawesome.github.io/Font-Awesome/" target="_blank">fontawesome</a>, набор иконок и стилей CSS</li>\r\n    </ul>\r\n\r\n    <p>&nbsp;</p>\r\n    <h2><i class="fa fa-question-circle"></i> Вопросы</h2>\r\n    <p>Если обнаружили ошибку, пожалуйста,\r\n        <a href="https://github.com/oknosoft/order-online/issues/new" target="_blank">зарегистрируйте вопрос в GitHub</a> или\r\n        <a href="http://www.oknosoft.ru/metadata/#page-118" target="_blank">свяжитесь с разработчиком</a> напрямую<br /></p>\r\n    <p>&nbsp;</p>\r\n\r\n</div>',
"view_settings.html":'<div class="md_column1300">\r\n\r\n    <div class="md_column320" name="form1" style="max-width: 400px;"><div></div></div>\r\n\r\n    <div class="md_column320" name="form2" style="max-width: 400px;"><div></div></div>\r\n\r\n</div>',"toolbar_buyers_order_obj.xml":'<?xml version="1.0" encoding=\'utf-8\'?>\r\n<toolbar>\r\n    <item id="sep0" type="separator"/>\r\n    <item type="button" id="btn_save_close" text="&lt;i class=\'fa fa-caret-square-o-down fa-fw\'&gt;&lt;/i&gt;" title="Записать и закрыть"/>\r\n    <item type="button" id="btn_save" text="&lt;i class=\'fa fa-floppy-o fa-fw\'&gt;&lt;/i&gt;" title="Записать"/>\r\n    <item type="button" id="btn_sent" text="&lt;i class=\'fa fa-paper-plane-o fa-fw\'&gt;&lt;/i&gt;" title="Отправить заказ" />\r\n\r\n    <item type="button" id="btn_post" enabled="false" text="&lt;i class=\'fa fa-check-square-o fa-fw\'&gt;&lt;/i&gt;" title="Провести документ" />\r\n    <item type="button" id="btn_unpost" enabled="false" text="&lt;i class=\'fa fa-square-o fa-fw\'&gt;&lt;/i&gt;" title="Отмена проведения" />\r\n\r\n    <item type="button" id="btn_files" text="&lt;i class=\'fa fa-paperclip fa-fw\'&gt;&lt;/i&gt;" title="Присоединенные файлы"/>\r\n\r\n    <item type="buttonSelect" id="bs_print" text="&lt;i class=\'fa fa-print fa-fw\'&gt;&lt;/i&gt;" title="Печать" openAll="true">\r\n    </item>\r\n\r\n    <item type="buttonSelect" id="bs_create_by_virtue" text="&lt;i class=\'fa fa-bolt fa-fw\'&gt;&lt;/i&gt;" title="Создать на основании" openAll="true" >\r\n        <item type="button" id="btn_message" enabled="false" text="Сообщение" />\r\n    </item>\r\n\r\n    <item type="buttonSelect" id="bs_go_to" text="&lt;i class=\'fa fa-external-link fa-fw\'&gt;&lt;/i&gt;" title="Перейти" openAll="true" >\r\n        <item type="button" id="btn_go_connection" enabled="false" text="Связи" />\r\n    </item>\r\n\r\n    <item type="buttonSelect"   id="bs_more"  text="&lt;i class=\'fa fa-th-large fa-fw\'&gt;&lt;/i&gt;"  title="Дополнительно" openAll="true">\r\n        <item type="button"     id="btn_retrieve"    text="&lt;i class=\'fa fa-undo fa-fw\'&gt;&lt;/i&gt; Отозвать" title="Отозвать заказ" />\r\n        <item type="separator"  id="sep_export" />\r\n        <item type="button" id="btn_import" text="&lt;i class=\'fa fa-upload fa-fw\'&gt;&lt;/i&gt; Загрузить из файла" />\r\n        <item type="button" id="btn_export" text="&lt;i class=\'fa fa-download fa-fw\'&gt;&lt;/i&gt; Выгрузить в файл" />\r\n    </item>\r\n\r\n    <item id="sep_close_1" type="separator"/>\r\n    <item type="button" id="btn_close" text="&lt;i class=\'fa fa-times fa-fw\'&gt;&lt;/i&gt;" title="Закрыть форму"/>\r\n    <item id="sep_close_2" type="separator"/>\r\n\r\n</toolbar>',"tree_filteres.xml":'<?xml version="1.0" encoding="utf-8"?>\r\n<tree id="0">\r\n    <item id="draft" text="&lt;i class=\'fa fa-pencil fa-fw\'&gt;&lt;/i&gt; Черновики" select="1" tooltip="Предварительные расчеты"/>\r\n    <item id="sent" text="&lt;i class=\'fa fa-paper-plane-o fa-fw\'&gt;&lt;/i&gt; Отправлено" tooltip="Отправленные, но еще не принятые в работу. Могут быть отозваны (переведены в \'черновики\')" />\r\n    <item id="confirmed" text="&lt;i class=\'fa fa-thumbs-o-up fa-fw\'&gt;&lt;/i&gt; Согласовано" tooltip="Включены в план производства. Могут быть изменены менеджером. Недоступны для изменения дилером" />\r\n    <item id="declined" text="&lt;i class=\'fa fa-thumbs-o-down fa-fw\'&gt;&lt;/i&gt; Отклонено" tooltip="Не приняты в работу по техническим причинам. Требуется изменение конструктива или комплектации" />\r\n    <item id="execution" text="&lt;i class=\'fa fa-money fa-fw\'&gt;&lt;/i&gt; Долги" tooltip="Оплата, отгрузка" />\r\n    <item id="plan" text="&lt;i class=\'fa fa-calendar-check-o fa-fw\'&gt;&lt;/i&gt; План" tooltip="Согласованы, но еще не запущены в работу" />\r\n    <item id="underway" text="&lt;i class=\'fa fa-industry fa-fw\'&gt;&lt;/i&gt; В работе" tooltip="Включены в задания на производство, но еще не изготовлены" />\r\n    <item id="manufactured" text="&lt;i class=\'fa fa-gavel fa-fw\'&gt;&lt;/i&gt; Изготовлено" tooltip="Изготовлены, но еще не отгружены" />\r\n    <item id="executed" text="&lt;i class=\'fa fa-truck fa-fw\'&gt;&lt;/i&gt; Исполнено" tooltip="Отгружены клиенту" />\r\n\r\n    <item id="service" text="&lt;i class=\'fa fa-medkit fa-fw\'&gt;&lt;/i&gt; Сервис" tooltip="Сервисное обслуживание" />\r\n    <item id="complaints" text="&lt;i class=\'fa fa-frown-o fa-fw\'&gt;&lt;/i&gt; Рекламации" tooltip="Жалобы и рекламации" />\r\n\r\n    <item id="template" text="&lt;i class=\'fa fa-puzzle-piece fa-fw\'&gt;&lt;/i&gt; Шаблоны" tooltip="Типовые блоки" />\r\n    <item id="zarchive" text="&lt;i class=\'fa fa-archive fa-fw\'&gt;&lt;/i&gt; Архив" tooltip="Старые заказы" />\r\n    <item id="all" text="&lt;i class=\'fa fa-expand fa-fw\'&gt;&lt;/i&gt; Все" tooltip="Отключить фильтрацию" />\r\n</tree>\r\n',"create_tables.sql":"USE md;\nCREATE TABLE IF NOT EXISTS `ireg_$log` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, `date` INT, `sequence` INT, `class` CHAR, `note` CHAR, `obj` CHAR);\nCREATE TABLE IF NOT EXISTS `doc_nom_prices_setup` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, posted boolean, date Date, number_doc CHAR, `Комментарий` CHAR, `Ответственный` CHAR, `НеПроводитьНулевыеЗначения` BOOLEAN, `Информация` CHAR, `ts_goods` JSON, `ts_ТипыЦен` JSON);\nCREATE TABLE IF NOT EXISTS `doc_РасходныйКассовыйОрдер` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, posted boolean, date Date, number_doc CHAR, `organization` CHAR, `Касса` CHAR, `department` CHAR, `ВидОперации` CHAR, `Комментарий` CHAR, `partner` CHAR, `partner_T` CHAR, `contract` CHAR, `ВалютаВзаиморасчетовРаботника` CHAR, `doc_currency` CHAR, `doc_amount` FLOAT, `ДатаПогашенияАванса` Date, `РасчетныйДокумент` CHAR, `Выдать` CHAR, `Основание` CHAR, `Приложение` CHAR, `ПоДокументу` CHAR, `ОтраженоВОперУчете` BOOLEAN, `Оплачено` BOOLEAN, `Ответственный` CHAR, `ДокументОснование` CHAR, `ДокументОснование_T` CHAR, `ОтражатьВУправленческомУчете` BOOLEAN, `ОтражатьВБухгалтерскомУчете` BOOLEAN, `СтатьяДвиженияДенежныхСредств` CHAR, `СчетОрганизации` CHAR, `ОтражатьВНалоговомУчете` BOOLEAN, `ВидВыдачиДенежныхСредств` CHAR, `ОбъявлениеНаВзносНаличными` CHAR, `НомерЧекаККМ` INT, `ts_РасшифровкаПлатежа` JSON);\nCREATE TABLE IF NOT EXISTS `doc_ПриходныйКассовыйОрдер` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, posted boolean, date Date, number_doc CHAR, `organization` CHAR, `Касса` CHAR, `department` CHAR, `ВидОперации` CHAR, `partner` CHAR, `partner_T` CHAR, `contract` CHAR, `ВалютаВзаиморасчетовРаботника` CHAR, `doc_currency` CHAR, `doc_amount` FLOAT, `РасчетныйДокумент` CHAR, `РасчетныйДокумент_T` CHAR, `ПринятоОт` CHAR, `Основание` CHAR, `Приложение` CHAR, `ОтраженоВОперУчете` BOOLEAN, `Оплачено` BOOLEAN, `Ответственный` CHAR, `Комментарий` CHAR, `ДокументОснование` CHAR, `ДокументОснование_T` CHAR, `ОтражатьВУправленческомУчете` BOOLEAN, `ОтражатьВБухгалтерскомУчете` BOOLEAN, `СтатьяДвиженияДенежныхСредств` CHAR, `СчетОрганизации` CHAR, `ОтражатьВНалоговомУчете` BOOLEAN, `СтавкаНДС` CHAR, `НомерЧекаККМ` INT, `ВидПриемаРозничнойВыручки` CHAR, `ДенежныйЧек` CHAR, `ВыручкаСНТТ` BOOLEAN, `ts_РасшифровкаПлатежа` JSON);\nCREATE TABLE IF NOT EXISTS `doc_ПлатежныйОрдерСписаниеДенежныхСредств` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, posted boolean, date Date, number_doc CHAR, `РасчетныйДокумент` CHAR, `РасчетныйДокумент_T` CHAR, `ДокументОснование` CHAR, `ДокументОснование_T` CHAR, `organization` CHAR, `СчетОрганизации` CHAR, `partner` CHAR, `СчетКонтрагента` CHAR, `contract` CHAR, `doc_amount` FLOAT, `doc_currency` CHAR, `ОтраженоВОперУчете` BOOLEAN, `Комментарий` CHAR, `Ответственный` CHAR, `ВидОперации` CHAR, `ОтражатьВБухгалтерскомУчете` BOOLEAN, `СтатьяДвиженияДенежныхСредств` CHAR, `Оплачено` BOOLEAN, `ДатаОплаты` Date, `ОтражатьВНалоговомУчете` BOOLEAN, `department` CHAR, `НомерВходящегоДокумента` CHAR, `ДатаВходящегоДокумента` Date, `ФизЛицо` CHAR, `ВалютаВзаиморасчетовРаботника` CHAR, `ДатаПогашенияАванса` Date, `РасчетныйДокументРаботника` CHAR, `ts_РасшифровкаПлатежа` JSON, `ts_РеквизитыКонтрагента` JSON);\nCREATE TABLE IF NOT EXISTS `doc_ПлатежныйОрдерПоступлениеДенежныхСредств` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, posted boolean, date Date, number_doc CHAR, `РасчетныйДокумент` CHAR, `РасчетныйДокумент_T` CHAR, `ДокументОснование` CHAR, `ДокументОснование_T` CHAR, `organization` CHAR, `СчетОрганизации` CHAR, `partner` CHAR, `СчетКонтрагента` CHAR, `contract` CHAR, `doc_amount` FLOAT, `doc_currency` CHAR, `ВидОперации` CHAR, `ОтраженоВОперУчете` BOOLEAN, `Комментарий` CHAR, `Ответственный` CHAR, `ОтражатьВБухгалтерскомУчете` BOOLEAN, `СтатьяДвиженияДенежныхСредств` CHAR, `Оплачено` BOOLEAN, `ДатаОплаты` Date, `ОтражатьВНалоговомУчете` BOOLEAN, `department` CHAR, `КурсНаДатуПриобретенияРеализацииВалюты` FLOAT, `НазначениеПлатежа` CHAR, `СтатьяЗатрат` CHAR, `nom_group` CHAR, `ПодразделениеЗатраты` CHAR, `СуммаУслуг` FLOAT, `НомерВходящегоДокумента` CHAR, `ДатаВходящегоДокумента` Date, `ts_РасшифровкаПлатежа` JSON, `ts_РеквизитыКонтрагента` JSON);\nCREATE TABLE IF NOT EXISTS `doc_ПлатежноеПоручениеИсходящее` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, posted boolean, date Date, number_doc CHAR, `doc_currency` CHAR, `ВидОперации` CHAR, `ВидПлатежа` CHAR, `ДатаОплаты` Date, `contract` CHAR, `ДокументОснование` CHAR, `ДокументОснование_T` CHAR, `ИННПлательщика` CHAR, `ИННПолучателя` CHAR, `КодБК` CHAR, `КодОКАТО` CHAR, `Комментарий` CHAR, `partner` CHAR, `КПППлательщика` CHAR, `КПППолучателя` CHAR, `НазначениеПлатежа` CHAR, `Оплачено` BOOLEAN, `organization` CHAR, `Ответственный` CHAR, `ОтражатьВБухгалтерскомУчете` BOOLEAN, `ОтражатьВНалоговомУчете` BOOLEAN, `ОтраженоВОперУчете` BOOLEAN, `ОчередностьПлатежа` INT, `ПоказательДаты` Date, `ПоказательНомера` CHAR, `ПоказательОснования` CHAR, `ПоказательПериода` CHAR, `ПоказательТипа` CHAR, `СтатусСоставителя` CHAR, `СтатьяДвиженияДенежныхСредств` CHAR, `doc_amount` FLOAT, `СчетКонтрагента` CHAR, `СчетОрганизации` CHAR, `ТекстПлательщика` CHAR, `ТекстПолучателя` CHAR, `ЧастичнаяОплата` BOOLEAN, `ФизЛицо` CHAR, `department` CHAR, `ВалютаВзаиморасчетовРаботника` CHAR, `ДатаПогашенияАванса` Date, `РасчетныйДокументРаботника` CHAR, `ПеречислениеВБюджет` BOOLEAN, `ВидПеречисленияВБюджет` CHAR, `ИдентификаторПлатежа` CHAR, `ts_РасшифровкаПлатежа` JSON, `ts_РеквизитыКонтрагента` JSON);\nCREATE TABLE IF NOT EXISTS `doc_ПлатежноеПоручениеВходящее` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, posted boolean, date Date, number_doc CHAR, `ДокументОснование` CHAR, `ДокументОснование_T` CHAR, `ДатаВходящегоДокумента` Date, `НомерВходящегоДокумента` CHAR, `organization` CHAR, `СчетОрганизации` CHAR, `partner` CHAR, `СчетКонтрагента` CHAR, `contract` CHAR, `doc_amount` FLOAT, `doc_currency` CHAR, `ВидОперации` CHAR, `ОтраженоВОперУчете` BOOLEAN, `Оплачено` BOOLEAN, `ДатаОплаты` Date, `ЧастичнаяОплата` BOOLEAN, `Комментарий` CHAR, `Ответственный` CHAR, `ОтражатьВБухгалтерскомУчете` BOOLEAN, `СтатьяДвиженияДенежныхСредств` CHAR, `ОтражатьВНалоговомУчете` BOOLEAN, `department` CHAR, `НазначениеПлатежа` CHAR, `СтатьяЗатрат` CHAR, `nom_group` CHAR, `ПодразделениеЗатраты` CHAR, `СуммаУслуг` FLOAT, `ts_РасшифровкаПлатежа` JSON, `ts_РеквизитыКонтрагента` JSON);\nCREATE TABLE IF NOT EXISTS `doc_КорректировкаЗаказаПокупателя` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, posted boolean, date Date, number_doc CHAR, `buyers_order` CHAR, `Комментарий` CHAR, `doc_amount` FLOAT, `ТипЦен` CHAR, `УчитыватьНДС` BOOLEAN, `СуммаВключаетНДС` BOOLEAN, `СтруктурнаяЕдиница` CHAR, `СтруктурнаяЕдиница_T` CHAR, `КурсВзаиморасчетов` FLOAT, `КратностьВзаиморасчетов` INT, `Ответственный` CHAR, `ИтогПлановаяСебестоимость` FLOAT, `ИспользоватьПлановуюСебестоимость` BOOLEAN, `ДисконтнаяКарта` CHAR, `partner` CHAR, `УсловиеПродаж` CHAR, `organization` CHAR, `ts_goods` JSON, `ts_ВозвратнаяТара` JSON, `ts_services` JSON);\nCREATE TABLE IF NOT EXISTS `doc_КорректировкаДолга` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, posted boolean, date Date, number_doc CHAR, `organization` CHAR, `КонтрагентДебитор` CHAR, `department` CHAR, `Ответственный` CHAR, `Комментарий` CHAR, `ОтражатьВУправленческомУчете` BOOLEAN, `ОтражатьВБухгалтерскомУчете` BOOLEAN, `ВидОперации` CHAR, `doc_currency` CHAR, `КурсДокумента` FLOAT, `КратностьДокумента` INT, `КонтрагентКредитор` CHAR, `contract` CHAR, `Сделка` CHAR, `Сделка_T` CHAR, `ОтражатьВНалоговомУчете` BOOLEAN, `ts_СуммыДолга` JSON);\nCREATE TABLE IF NOT EXISTS `doc_ЗакрытиеЗаказовПокупателей` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, posted boolean, date Date, number_doc CHAR, `Комментарий` CHAR, `ВидОперации` CHAR, `department` CHAR, `Ответственный` CHAR, `СпособЗаполнения` CHAR, `ts_Заказы` JSON);\nCREATE TABLE IF NOT EXISTS `doc_buyers_order` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, posted boolean, date Date, number_doc CHAR, `organization` CHAR, `doc_currency` CHAR, `ДатаОплаты` Date, `ДатаОтгрузки` Date, `contract` CHAR, `ИспользоватьПлановуюСебестоимость` BOOLEAN, `ИтогПлановаяСебестоимость` FLOAT, `СтруктурнаяЕдиница` CHAR, `СтруктурнаяЕдиница_T` CHAR, `Комментарий` CHAR, `department` CHAR, `doc_amount` FLOAT, `АдресДоставки` CHAR, `Ответственный` CHAR, `УчитыватьНДС` BOOLEAN, `СуммаВключаетНДС` BOOLEAN, `СкладГруппа` CHAR, `СкладГруппа_T` CHAR, `КурсВзаиморасчетов` FLOAT, `КратностьВзаиморасчетов` INT, `ТипЦен` CHAR, `partner` CHAR, `Грузополучатель` CHAR, `КонтактноеЛицоКонтрагента` CHAR, `УсловиеПродаж` CHAR, `ДополнениеКАдресуДоставки` CHAR, `ДокументОснование` CHAR, `ДокументОснование_T` CHAR, `Грузоотправитель` CHAR, `obj_delivery_state` CHAR, `ts_goods` JSON, `ts_ВозвратнаяТара` JSON, `ts_services` JSON, `ts_СоставНабора` JSON);\nCREATE TABLE IF NOT EXISTS `cat_ЦеновыеГруппы` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `sequence` INT, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_characteristics` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `owner` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_ФизическиеЛица` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `ДатаРождения` Date, `Комментарий` CHAR, `ОсновноеИзображение` CHAR, `Фамилия` CHAR, `Имя` CHAR, `Отчество` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_УсловияПродаж` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `cat_ТипыЦенНоменклатурыКонтрагентов` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `price_currency` CHAR, `ЦенаВключаетНДС` BOOLEAN, `ТипЦеныНоменклатуры` CHAR, `ОписаниеТипаЦеныНоменклатурыКонтрагента` CHAR, `Комментарий` CHAR, `owner` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_nom_prices_types` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `price_currency` CHAR, `БазовыйТипЦен` CHAR, `Рассчитывается` BOOLEAN, `discount_percent` FLOAT, `ЦенаВключаетНДС` BOOLEAN, `ПорядокОкругления` CHAR, `ОкруглятьВБольшуюСторону` BOOLEAN, `Комментарий` CHAR, `СпособРасчетаЦены` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_ТипыСкидокНаценок` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `currency` CHAR, `ДляВсейНоменклатуры` BOOLEAN, `discount_percent` FLOAT, `ЗначениеУсловия` CHAR, `ЗначениеУсловия_T` CHAR, `ОбщееВремяНачала` Date, `ОбщееВремяОкончания` Date, `ОграничениеСкидкиНаценки` FLOAT, `condition` CHAR, `Качество` CHAR, `ДляВсехПолучателей` BOOLEAN, `ПоДнямНедели` BOOLEAN, `ВидСкидки` CHAR, `ts_ВремяПоДнямНедели` JSON);\nCREATE TABLE IF NOT EXISTS `cat_СтатьиЗатрат` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `ВидЗатрат` CHAR, `ХарактерЗатрат` CHAR, `ОтнесениеРасходовКДеятельностиЕНВД` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_СтатьиДвиженияДенежныхСредств` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `cat_Склады` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `Комментарий` CHAR, `ТипЦенРозничнойТорговли` CHAR, `department` CHAR, `ВидСклада` CHAR, `НомерСекции` INT, `РасчетРозничныхЦенПоТорговойНаценке` BOOLEAN, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_СерийныеНомера` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `owner` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_СерииНоменклатуры` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `СерийныйНомер` CHAR, `Сертификат` CHAR, `СрокГодности` Date, `НомерГТД` CHAR, `СтранаПроисхождения` CHAR, `ОсновноеИзображение` CHAR, `Комментарий` CHAR, `owner` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_РолиКонтактныхЛиц` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `cat_Регионы` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `Комментарий` CHAR, `КодРегиона` CHAR, `КодАдресногоЭлемента` INT, `ЖДСтанцияНазначения` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_Проекты` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `ДатаНачала` Date, `ДатаОкончания` Date, `Ответственный` CHAR, `Описание` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_ПричиныЗакрытияЗаказов` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `cat_users` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `ФизЛицо` CHAR, `ИдентификаторПользователяИБ` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_divisions` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_organizations` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `ИНН` CHAR, `КодИМНС` CHAR, `КодПоОКАТО` CHAR, `КодПоОКТМО` CHAR, `КодПоОКПО` CHAR, `КПП` CHAR, `НаименованиеПлательщикаПриПеречисленииНалогов` CHAR, `НаименованиеПолное` CHAR, `ОГРН` CHAR, `ОсновнойБанковскийСчет` CHAR, `prefix` CHAR, `СвидетельствоДатаВыдачи` Date, `СвидетельствоСерияНомер` CHAR, `ЮрФизЛицо` CHAR, `ОтражатьВРегламентированномУчете` BOOLEAN);\nCREATE TABLE IF NOT EXISTS `cat_НомераГТД` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `Комментарий` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_nom_groups` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `storage_unit` CHAR, `base_unit` CHAR, `СтавкаНДС` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_nom` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `СтатьяЗатрат` CHAR, `Артикул` CHAR, `base_unit` CHAR, `ВестиУчетПоСериям` BOOLEAN, `ВестиУчетПоХарактеристикам` BOOLEAN, `ЕдиницаДляОтчетов` CHAR, `storage_unit` CHAR, `Комментарий` CHAR, `Набор` BOOLEAN, `nom_group` CHAR, `НомерГТД` CHAR, `СтавкаНДС` CHAR, `СтранаПроисхождения` CHAR, `Услуга` BOOLEAN, `nom_kind` CHAR, `ВестиСерийныеНомера` BOOLEAN, `Комплект` BOOLEAN, `ЦеноваяГруппа` CHAR, `ЕдиницаИзмеренияМест` CHAR, `Производитель` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_partners` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `НаименованиеПолное` CHAR, `ГоловнойКонтрагент` CHAR, `ДополнительноеОписание` CHAR, `ОсновнойБанковскийСчет` CHAR, `Комментарий` CHAR, `КПП` CHAR, `КодПоОКПО` CHAR, `ИНН` CHAR, `ЮрФизЛицо` CHAR, `main_contract` CHAR, `ОсновнойВидДеятельности` CHAR, `ДокументУдостоверяющийЛичность` CHAR, `ОсновнойМенеджерПокупателя` CHAR, `Покупатель` BOOLEAN, `Поставщик` BOOLEAN, `ОКОПФ` CHAR, `Регион` CHAR, `ОсновноеКонтактноеЛицо` CHAR, `АдресЭП` CHAR, `parent` CHAR, `ts_ВидыДеятельности` JSON, `ts_МенеджерыПокупателя` JSON);\nCREATE TABLE IF NOT EXISTS `cat_contact_persons_partners` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `Должность` CHAR, `Комментарий` CHAR, `КонтактноеЛицо` CHAR, `РольКонтактногоЛица` CHAR, `owner` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_КонтактныеЛица` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `ДатаРождения` Date, `Имя` CHAR, `КоличествоДнейДоНапоминания` INT, `НапоминатьОДнеРождения` BOOLEAN, `Описание` CHAR, `Отчество` CHAR, `Фамилия` CHAR, `Пол` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_КлассификаторСтранМира` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `НаименованиеПолное` CHAR, `КодАльфа2` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_units` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `НаименованиеПолное` CHAR, `МеждународноеСокращение` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_Качество` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `cat_КатегорииОбъектов` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `НазначениеКатегории` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_Кассы` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `funds_currency` CHAR, `owner` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_users_acl` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `prefix` CHAR, `owner` CHAR, `ts_ОбъектыДоступа` JSON);\nCREATE TABLE IF NOT EXISTS `cat_meta_ids` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `ПорядокКоллекции` INT, `Имя` CHAR, `synonym` CHAR, `ПолноеИмя` CHAR, `ПолныйСиноним` CHAR, `БезДанных` BOOLEAN, `ЗначениеПустойСсылки` CHAR, `ЗначениеПустойСсылки_T` CHAR, `КлючОбъектаМетаданных` CHAR, `НоваяСсылка` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_property_values` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `owner` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_nom_units` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `qualifier_unit` CHAR, `Вес` FLOAT, `Объем` FLOAT, `Коэффициент` FLOAT, `owner` CHAR, `owner_T` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_contracts` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `settlements_currency` CHAR, `ВедениеВзаиморасчетов` CHAR, `ВидВзаиморасчетов` CHAR, `ДержатьРезервБезОплатыОграниченноеВремя` BOOLEAN, `ДопустимаяСуммаЗадолженности` FLOAT, `ДопустимоеЧислоДнейЗадолженности` INT, `Комментарий` CHAR, `КонтролироватьСуммуЗадолженности` BOOLEAN, `КонтролироватьЧислоДнейЗадолженности` BOOLEAN, `organization` CHAR, `ПроцентПредоплаты` FLOAT, `ТипЦен` CHAR, `ТипЦен_T` CHAR, `ЧислоДнейРезерваБезОплаты` INT, `contract_kind` CHAR, `date` Date, `number_doc` CHAR, `ОсновнойПроект` CHAR, `ОсновнойПроект_T` CHAR, `ОсновнаяСтатьяДвиженияДенежныхСредств` CHAR, `СрокДействия` Date, `owner` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_nom_kinds` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `nom_type` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_contact_information_kinds` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `type` CHAR, `ВидОбъектаКонтактнойИнформации` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_ВидыВзаиморасчетов` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `cat_currencies` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `НаименованиеПолное` CHAR, `ПараметрыПрописиНаРусском` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_bank_accounts` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `НомерСчета` CHAR, `Банк` CHAR, `БанкДляРасчетов` CHAR, `ТекстКорреспондента` CHAR, `ТекстНазначения` CHAR, `ВидСчета` CHAR, `funds_currency` CHAR, `НомерИДатаРазрешения` CHAR, `ДатаОткрытия` Date, `ДатаЗакрытия` Date, `МесяцПрописью` BOOLEAN, `СуммаБезКопеек` BOOLEAN, `owner` CHAR, `owner_T` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_banks_qualifier` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `КоррСчет` CHAR, `Город` CHAR, `Адрес` CHAR, `Телефоны` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cch_properties` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `НазначениеСвойства` CHAR, `type` JSON);\nCREATE TABLE IF NOT EXISTS `cch_predefined_elmnts` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `value` CHAR, `value_T` CHAR, `Описание` CHAR, `synonym` CHAR, `Список` INT, `parent` CHAR, `type` CHAR, `ts_Элементы` JSON);\nCREATE TABLE IF NOT EXISTS `cch_destinations` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `parent` CHAR, `type` CHAR);\nCREATE TABLE IF NOT EXISTS `enm_ЮрФизЛицо` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_ТипыХраненияФайлов` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_ТипыТекстовЭлектронныхПисем` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_ТипыПроблемОбменаДанными` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_ТипыПользователей` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_nom_types` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_contact_information_types` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_СтавкиНДС` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_obj_delivery_states` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_ВидыСкладов` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_contract_kinds` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_mutual_contract_settlements` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_accumulation_record_type` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\n"}),$p.on({settings:function(e,t){e.__define({local_storage_prefix:{value:"oo_"},skin:{value:"dhx_terrace"},pouch_filter:{value:function(){var e={};return e.__define({doc:{value:"auth/by_partner",writable:!1}}),e}(),writable:!1},guests:{value:[{username:"Дилер",password:"1gNjzYQKBlcD"}]},irest_enabled:{value:!0},rest_path:{value:"/a/zd/%1/odata/standard.odata/"},keep_hash:{value:!0},guest_name:{value:"guest"},guest_pwd:{value:"meta"}}),e.zone=0,e.zone_demo=1,e.couch_path="/couchdb/oo_",e.enable_save_pwd=!0},iface_init:function(){$p.iface.sidebar_items=[{id:"orders",text:"Заказы",icon:"projects_48.png"},{id:"settings",text:"Настройки",icon:"settings_48.png"},{id:"about",text:"О программе",icon:"about_48.png"}],$p.iface.btn_auth_sync=new $p.iface.OBtnAuthSync,$p.iface.btns_nav=function(e){return $p.iface.btn_auth_sync.bind(new $p.iface.OTooolBar({wrapper:e,class_name:"md_otbnav",width:"260px",height:"28px",top:"3px",right:"3px",name:"right",buttons:[{name:"about",text:'<i class="fa fa-info-circle md-fa-lg"></i>',tooltip:"О программе","float":"right"},{name:"settings",text:'<i class="fa fa-cog md-fa-lg"></i>',tooltip:"Настройки","float":"right"},{name:"orders",text:'<i class="fa fa-suitcase md-fa-lg"></i>',tooltip:"Заказы","float":"right"},{name:"sep_0",text:"","float":"right"},{name:"sync",text:"","float":"right"},{name:"auth",text:"",width:"80px","float":"right"}],onclick:function(e){return $p.iface.main.cells(e).setActive(!0),!1}}))}},meta:function(){document.body.removeChild(document.querySelector("#osplash")),$p.iface.main=new dhtmlXSideBar({parent:document.body,icons_path:"dist/imgs/",width:180,header:!0,template:"tiles",autohide:!0,items:$p.iface.sidebar_items,offsets:{top:0,right:0,bottom:0,left:0}}),$p.iface.main.attachEvent("onSelect",function(e){var t=$p.job_prm.parse_url();t.view!=e&&$p.iface.set_hash(t.obj,t.ref,t.frm,e),$p.iface["view_"+e]($p.iface.main.cells(e))}),$p.iface.main.progressOn(),hprm=$p.job_prm.parse_url(),hprm.view&&$p.iface.main.getAllItems().indexOf(hprm.view)!=-1?setTimeout($p.iface.hash_route):$p.iface.set_hash(hprm.obj,hprm.ref,hprm.frm,"orders")},hash_route:function(e){return e.view&&$p.iface.main.getActiveItem()!=e.view&&$p.iface.main.getAllItems().forEach(function(t){t==e.view&&$p.iface.main.cells(t).setActive(!0)}),!1},predefined_elmnts_inited:function e(){$p.iface.main.progressOff(),$p.off(e),!$p.wsql.pouch.authorized&&navigator.onLine&&$p.wsql.get_user_param("enable_save_pwd")&&$p.wsql.get_user_param("user_name")&&$p.wsql.get_user_param("user_pwd")&&setTimeout(function(){$p.iface.frm_auth({modal_dialog:!0,try_auto:!0})},100)},pouch_load_data_error:function t(e){e.db_name&&e.hasOwnProperty("doc_count")&&e.doc_count<10&&navigator.onLine&&($p.wsql.get_user_param("zone")!=$p.job_prm.zone_demo||$p.wsql.get_user_param("user_name")?$p.iface.frm_auth({modal_dialog:!0,try_auto:$p.wsql.get_user_param("zone")==$p.job_prm.zone_demo&&$p.wsql.get_user_param("enable_save_pwd")}):($p.wsql.set_user_param("enable_save_pwd",!0),$p.wsql.set_user_param("user_name",$p.job_prm.guests[0].username),$p.wsql.set_user_param("user_pwd",$p.job_prm.guests[0].password),setTimeout(function(){$p.iface.frm_auth({modal_dialog:!0,try_auto:!0})},100))),$p.iface.main.progressOff(),$p.off(t)}}),$p.iface.view_about=function(e){function t(){e.attachHTMLString($p.injected_data["view_about.html"]),e.cell.querySelector(".dhx_cell_cont_sidebar").style.overflow="auto",this.tb_nav=$p.iface.btns_nav(e.cell.querySelector(".dhx_cell_sidebar_hdr"))}return $p.iface._about||($p.iface._about=new t)},$p.iface.view_orders=function(e){function t(){function t(){i.carousel.cells("list").setActive(),e.setText({text:"Заказы"}),i.list||(i.carousel.cells("list").detachObject(!0),i.list=$p.doc.buyers_order.form_list(i.carousel.cells("list")))}function a(t){var a=i.carousel.cells("doc");a.setActive(),a.ref&&a.ref==t?i.doc&&i.doc.wnd&&setTimeout(i.doc.wnd.set_text.bind(i.doc.wnd,!0),200):$p.doc.buyers_order.form_obj(a,{ref:t,bind_pwnd:!0,on_close:function(){setTimeout(function(){$p.iface.set_hash(void 0,"","list")})},set_text:function(t){i.carousel.getActiveCell()==a&&e.setText({text:"<b>"+t+"</b>"})}}).then(function(e){i.doc=e,setTimeout(i.doc.wnd.set_text.bind(i.doc.wnd,!0),200)})}function n(e){return"orders"!=e.view||("doc.buyers_order"!=e.obj||$p.utils.is_empty_guid(e.ref)?"doc.buyers_order"!=e.obj?setTimeout(function(){$p.iface.set_hash("doc.buyers_order","","list")}):t():"doc"!=e.frm?setTimeout(function(){$p.iface.set_hash(void 0,void 0,"doc")}):a(e.ref),!1)}function r(){$p.off(r),setTimeout(function(){$p.iface.set_hash($p.job_prm.parse_url().obj||"doc.buyers_order")})}var i=this;i.tb_nav=$p.iface.btns_nav(e.cell.querySelector(".dhx_cell_sidebar_hdr")),i.carousel=e.attachCarousel({keys:!1,touch_scroll:!1,offset_left:0,offset_top:0,offset_item:0}),i.carousel.hideControls(),i.carousel.addCell("list"),i.carousel.addCell("doc"),
$p.job_prm.properties?setTimeout(r):$p.on({predefined_elmnts_inited:r}),$p.on("hash_route",n)}return $p.iface._orders||($p.iface._orders=new t)},$p.iface.view_settings=function(e){function t(){function t(e){return"settings"!=e.view}function a(){if(n&&$p.eve.detachEvent(n),r.form2.isLocked()&&r.form2.unlock(),$p.wsql.get_user_param("hide_price_dealer")?r.form2.checkItem("hide_price","hide_price_dealer"):$p.wsql.get_user_param("hide_price_manufacturer")?r.form2.checkItem("hide_price","hide_price_manufacturer"):r.form2.checkItem("hide_price","hide_price_no"),$p.current_acl.partners_uids.length){var e=$p.cat.partners.get($p.current_acl.partners_uids[0]),t={calc_order_row:{nom:$p.cat.nom.get(),_owner:{_owner:{partner:e}}}};$p.pricing.price_type(t),r.form2.setItemValue("surcharge_internal",t.price_type.extra_charge_external)}else r.form2.disableItem("surcharge_internal"),r.form2.disableItem("discount_percent_internal");r.form2.attachEvent("onChange",function(e,t,a){"hide_price"==e&&("hide_price_dealer"==t?($p.wsql.set_user_param("hide_price_dealer",!0),$p.wsql.set_user_param("hide_price_manufacturer","")):"hide_price_manufacturer"==t?($p.wsql.set_user_param("hide_price_dealer",""),$p.wsql.set_user_param("hide_price_manufacturer",!0)):($p.wsql.set_user_param("hide_price_dealer",""),$p.wsql.set_user_param("hide_price_manufacturer","")))}),r.form2.getInput("modifiers").onchange=function(){$p.wsql.set_user_param("modifiers",this.value)}}var n,r=this;r.tb_nav=$p.iface.btns_nav(e.cell.querySelector(".dhx_cell_sidebar_hdr")),r.tabs=e.attachTabbar({arrows_mode:"auto",tabs:[{id:"const",text:'<i class="fa fa-key"></i> Общее',active:!0},{id:"industry",text:'<i class="fa fa-industry"></i> Технология'},{id:"price",text:'<i class="fa fa-money"></i> Учет'},{id:"events",text:'<i class="fa fa-calendar-check-o"></i> Планирование'}]}),r.tabs.attachEvent("onSelect",function(e){return r[e]&&r[e].tree&&r[e].tree.getSelectedItemId()&&r[e].tree.callEvent("onSelect",[r[e].tree.getSelectedItemId()]),!0}),r.tabs.cells("const").attachHTMLString($p.injected_data["view_settings.html"]),r["const"]=r.tabs.cells("const").cell.querySelector(".dhx_cell_cont_tabbar"),r["const"].style.overflow="auto",r.form1=r["const"].querySelector("[name=form1]"),r.form1=new dhtmlXForm(r.form1.firstChild,[{type:"settings",labelWidth:80,position:"label-left"},{type:"label",labelWidth:320,label:"Тип устройства",className:"label_options"},{type:"block",blockOffset:0,name:"block_device_type",list:[{type:"settings",labelAlign:"left",position:"label-right"},{type:"radio",name:"device_type",labelWidth:120,label:'<i class="fa fa-desktop"></i> Компьютер',value:"desktop"},{type:"newcolumn"},{type:"radio",name:"device_type",labelWidth:150,label:'<i class="fa fa-mobile fa-lg"></i> Телефон, планшет',value:"phone"}]},{type:"template",label:"",value:"",note:{text:"Класс устройства определяется автоматически, но пользователь может задать его явно",width:320}},{type:"label",labelWidth:320,label:"Адрес CouchDB",className:"label_options"},{type:"input",inputWidth:220,name:"couch_path",label:"Путь:",validate:"NotEmpty"},{type:"template",label:"",value:"",note:{text:"Можно указать как относительный, так и абсолютный URL публикации CouchDB",width:320}},{type:"label",labelWidth:320,label:"Значение разделителя данных",className:"label_options"},{type:"input",inputWidth:220,name:"zone",label:"Зона:",numberFormat:["0","",""],validate:"NotEmpty,ValidInteger"},{type:"template",label:"",value:"",note:{text:"Для неразделенной публикации, зона = 0",width:320}},{type:"label",labelWidth:320,label:"Суффикс базы пользователя",className:"label_options"},{type:"input",inputWidth:220,name:"couch_suffix",label:"Суффикс:"},{type:"template",label:"",value:"",note:{text:"Назначается дилеру при регистрации",width:320}},{type:"label",labelWidth:320,label:"Сохранять пароль пользователя",className:"label_options"},{type:"checkbox",name:"enable_save_pwd",label:"Разрешить:",checked:$p.wsql.get_user_param("enable_save_pwd","boolean")},{type:"template",label:"",value:"",note:{text:"Не рекомендуется, если к компьютеру имеют доступ посторонние лица",width:320}},{type:"template",label:"",value:"",note:{text:"",width:320}},{type:"block",blockOffset:0,name:"block_buttons",list:[{type:"button",name:"save",value:"<i class='fa fa-floppy-o fa-lg'></i>",tooltip:"Применить настройки и перезагрузить программу"},{type:"newcolumn"},{type:"button",offsetLeft:20,name:"reset",value:"<i class='fa fa-refresh fa-lg'></i>",tooltip:"Стереть справочники и перезаполнить данными сервера"},{type:"newcolumn"},{type:"button",offsetLeft:60,name:"upload",value:"<i class='fa fa-cloud-upload fa-lg'></i>",tooltip:"Выгрузить изменения справочников на сервер"}]}]),r.form1.cont.style.fontSize="100%",r.form1.checkItem("device_type",$p.job_prm.device_type),["zone","couch_path","couch_suffix"].forEach(function(e){"zone"==e?r.form1.setItemValue(e,$p.wsql.get_user_param(e)):r.form1.setItemValue(e,$p.wsql.get_user_param(e)||$p.job_prm[e])}),r.form1.attachEvent("onChange",function(e,t,a){$p.wsql.set_user_param(e,"enable_save_pwd"==e?a||"":t)}),r.form1.attachEvent("onButtonClick",function(e){"save"==e?location.reload():"reset"==e?dhtmlx.confirm({title:"Сброс данных",text:"Стереть справочники и перезаполнить данными сервера?",cancel:$p.msg.cancel,callback:function(e){e&&$p.wsql.pouch.reset_local_data()}}):"upload"==e&&$p.pricing.cut_upload()}),r.form2=r["const"].querySelector("[name=form2]"),r.form2=new dhtmlXForm(r.form2.firstChild,[{type:"settings",labelWidth:220,position:"label-left"},{type:"label",labelWidth:320,label:"Колонки цен",className:"label_options"},{type:"block",blockOffset:0,name:"block_hide_price",list:[{type:"settings",labelAlign:"left",position:"label-right"},{type:"radio",name:"hide_price",label:'<i class="fa fa-eye fa-fw"></i> Показывать все цены',value:"hide_price_no"},{type:"radio",name:"hide_price",label:'<i class="fa fa-user-secret fa-fw"></i> Скрыть цены дилера',value:"hide_price_dealer"},{type:"radio",name:"hide_price",label:'<i class="fa fa-university fa-fw"></i> Скрыть цены завода',value:"hide_price_manufacturer"}]},{type:"template",label:"",value:"",note:{text:"Настройка видимости колонок в документе 'Расчет' и графическом построителе",width:320}},{type:"label",labelWidth:320,label:"Наценки и скидки",className:"label_options"},{type:"input",labelWidth:180,inputWidth:120,name:"surcharge_internal",label:"Наценка дилера, %:",numberFormat:["0","",""],validate:"NotEmpty,ValidInteger"},{type:"input",labelWidth:180,inputWidth:120,name:"discount_percent_internal",label:"Скидка дилера, %:",numberFormat:["0","",""],validate:"NotEmpty,ValidInteger"},{type:"template",label:"",value:"",note:{text:"Значения наценки и скидки по умолчанию, которые дилер предоставляет своим (конечным) покупателям",width:320}},{type:"label",labelWidth:320,label:"Подключаемые модули",className:"label_options"},{type:"input",position:"label-top",inputWidth:320,name:"modifiers",label:"Модификаторы:",value:$p.wsql.get_user_param("modifiers"),rows:3,style:"height:80px;"},{type:"template",label:"",value:"",note:{text:"Список дополнительных модулей",width:320}}]),r.form2.cont.style.fontSize="100%",$p.cat.partners.alatable.length&&$p.current_acl?a():(r.form2.lock(),n=$p.eve.attachEvent("predefined_elmnts_inited",a)),r.industry={layout:r.tabs.cells("industry").attachLayout({pattern:"2U",cells:[{id:"a",text:"Разделы",collapsed_text:"Разделы",width:200},{id:"b",text:"Раздел",header:!1}],offsets:{top:0,right:0,bottom:0,left:0}})},r.industry.tree=r.industry.layout.cells("a").attachTree(),r.industry.tree.enableTreeImages(!1),r.industry.tree.parse($p.injected_data["tree_industry.xml"]),r.industry.tree.attachEvent("onSelect",function(e){$p.md.mgr_by_class_name(e).form_list(r.industry.layout.cells("b"),{hide_header:!0})}),r.price={layout:r.tabs.cells("price").attachLayout({pattern:"2U",cells:[{id:"a",text:"Разделы",collapsed_text:"Разделы",width:200},{id:"b",text:"Раздел",header:!1}],offsets:{top:0,right:0,bottom:0,left:0}})},r.price.tree=r.price.layout.cells("a").attachTree(),r.price.tree.enableTreeImages(!1),r.price.tree.parse($p.injected_data["tree_price.xml"]),r.price.tree.attachEvent("onSelect",function(e){$p.md.mgr_by_class_name(e).form_list(r.price.layout.cells("b"),{hide_header:!0})}),r.events={layout:r.tabs.cells("events").attachLayout({pattern:"2U",cells:[{id:"a",text:"Разделы",collapsed_text:"Разделы",width:200},{id:"b",text:"Раздел",header:!1}],offsets:{top:0,right:0,bottom:0,left:0}})},r.events.tree=r.events.layout.cells("a").attachTree(),r.events.tree.enableTreeImages(!1),r.events.tree.parse($p.injected_data["tree_events.xml"]),r.events.tree.attachEvent("onSelect",function(e){$p.md.mgr_by_class_name(e).form_list(r.events.layout.cells("b"),{hide_header:!0})}),$p.on("hash_route",t)}return $p.iface._settings||($p.iface._settings=new t)}});