!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.Orders=t()}(this,function(){$p.modifiers.push(function(e){var t=e.cat.contracts;t.sql_selection_list_flds=function(e){return"SELECT _t_.ref, _t_.`_deleted`, _t_.is_folder, _t_.id, _t_.name as presentation, _k_.synonym as contract_kind, _m_.synonym as mutual_settlements, _o_.name as organization, _p_.name as partner, case when _t_.ref = '"+e+"' then 0 else 1 end as is_initial_value FROM cat_contracts AS _t_ left outer join cat_organizations as _o_ on _o_.ref = _t_.organization left outer join cat_partners as _p_ on _p_.ref = _t_.owner left outer join enm_mutual_contract_settlements as _m_ on _m_.ref = _t_.mutual_settlements left outer join enm_contract_kinds as _k_ on _k_.ref = _t_.contract_kind %3 %4 LIMIT 300"},t.by_partner_and_org=function(n,a,r){r||(r=e.enm.contract_kinds.СПокупателем);var i=t.find_rows({owner:n,organization:a,contract_kind:r});return i.sort(function(e,t){return e.date>t.date}),i.length?i[0]:t.get()}}),$p.modifiers.push(function(e){var t=e.cat.nom;t.sql_selection_list_flds=function(e){return"SELECT _t_.ref, _t_.`_deleted`, _t_.is_folder, _t_.id, _t_.article, _t_.name as presentation, _u_.name as nom_unit, _k_.name as nom_kind, case when _t_.ref = '"+e+"' then 0 else 1 end as is_initial_value FROM cat_nom AS _t_ left outer join cat_units as _u_ on _u_.ref = _t_.base_unit left outer join cat_nom_kinds as _k_ on _k_.ref = _t_.nom_kind %3 %4 LIMIT 300"},t.sql_selection_where_flds=function(e){return" OR _t_.article LIKE '"+e+"' OR _t_.id LIKE '"+e+"' OR _t_.name LIKE '"+e+"'"}}),$p.modifiers.push(function(e){var t=e.cat.partners;t.sql_selection_where_flds=function(e){return" OR inn LIKE '"+e+"' OR name_full LIKE '"+e+"' OR name LIKE '"+e+"'"},t._obj_constructor.prototype.__define({addr:{get:function(){return this.contact_information._obj.reduce(function(t,n){return n.kind==e.cat.contact_information_kinds.predefined("ЮрАдресКонтрагента")&&n.presentation?n.presentation:t?t:!n.presentation||n.kind!=e.cat.contact_information_kinds.predefined("ФактАдресКонтрагента")&&n.kind!=e.cat.contact_information_kinds.predefined("ПочтовыйАдресКонтрагента")?void 0:n.presentation},"")}},phone:{get:function(){return this.contact_information._obj.reduce(function(t,n){return n.kind==e.cat.contact_information_kinds.predefined("ТелефонКонтрагента")&&n.presentation?n.presentation:t?t:n.kind==e.cat.contact_information_kinds.predefined("ТелефонКонтрагентаМобильный")&&n.presentation?n.presentation:void 0},"")}},long_presentation:{get:function(){var e=this.name_full||this.name,t=this.addr,n=this.phone;return this.inn&&(e+=", ИНН"+this.inn),this.kpp&&(e+=", КПП"+this.kpp),t&&(e+=", "+t),n&&(e+=", "+n),e}}})}),$p.modifiers.push(function(e){e.cat.users_acl.__define({load_array:{value:function(t,n){var a,r,i,o=[];for(var s in t){if(a=e.utils.fix_guid(t[s]),i=t[s].acl,i&&delete t[s].acl,(r=this.by_ref[a])?(r.is_new()||n)&&(r._mixin(t[s]),r._set_loaded()):(r=new this._obj_constructor(t[s],this),n&&r._set_loaded()),i&&!r._acl){var _={};for(var s in i){_.__define(s,{value:{},writable:!1});for(var l in i[s])_[s].__define(l,{value:i[s][l],writable:!1})}r.__define({_acl:{value:_,writable:!1}})}o.push(r)}return o}}}),e.cat.users_acl._obj_constructor.prototype.__define({role_available:{value:function(e){return this.acl_objs._obj.some(function(t){return t.type==e})}},partners_uids:{get:function(){var t=[];return this.acl_objs.each(function(n){n.acl_obj instanceof e.cat.partners._obj_constructor&&t.push(n.acl_obj.ref)}),t}}})}),$p.modifiers.push(function(e){e.on({pouch_load_data_loaded:function n(){e.off(n),e.cch.predefined_elmnts.pouch_find_rows({_raw:!0,_top:500,_skip:0}).then(function(t){var n={};t.forEach(function(t){if(t.is_folder&&t.synonym){var a=t._id.split("|")[1];n[a]=t.synonym,e.job_prm.__define(t.synonym,{value:{}})}}),t.forEach(function(t){if(!t.is_folder&&t.synonym&&n[t.parent]&&!e.job_prm[n[t.parent]][t.synonym]){var a,r;t.type.is_ref&&(r=t.type.types[0].split("."),a=e[r[0]][r[1]]),t.list==-1?e.job_prm[n[t.parent]].__define(t.synonym,{value:function(){var e={};return t.elmnts.forEach(function(t){e[t.elm]=a?a.get(t.value,!1):t.value}),e}()}):t.list?e.job_prm[n[t.parent]].__define(t.synonym,{value:t.elmnts.map(function(e){return a?a.get(e.value,!1):e.value})}):(e.job_prm[n[t.parent]].hasOwnProperty(t.synonym)&&delete e.job_prm[n[t.parent]][t.synonym],e.job_prm[n[t.parent]].__define(t.synonym,{value:a?a.get(t.value,!1):t.value,configurable:!0}))}})}).then(function(){setTimeout(function(){e.eve.callEvent("predefined_elmnts_inited")},100)})}});var t=e.cch.predefined_elmnts;delete t._obj_constructor.prototype.value,t._obj_constructor.prototype.__define({value:{get:function(){var t,n=this.type,a=this._obj?this._obj.value:"";return this._obj.is_folder?"":"object"==typeof a?a:n.is_ref?n.digits&&"number"==typeof a?a:n.hasOwnProperty("str_len")&&!e.utils.is_guid(a)?a:(t=e.md.value_mgr(this._obj,"value",n))?e.utils.is_data_mgr(t)?t.get(a,!1):e.utils.fetch_type(a,t):a?(console.log(["value",n,this._obj]),null):this.characteristic.clr:n.date_part?e.utils.fix_date(this._obj.value,!0):n.digits?e.utils.fix_number(this._obj.value,!n.hasOwnProperty("str_len")):"boolean"==n.types[0]?e.utils.fix_boolean(this._obj.value):this._obj.value||""},set:function(t){this._obj.value!==t&&(Object.getNotifier(this).notify({type:"update",name:"value",oldValue:this._obj.value}),this._obj.value=e.utils.is_data_obj(t)?t.ref:t,this._data._modified=!0)}}}),t.form_obj=function(e,t){var n,a;return this.constructor.prototype.form_obj.call(this,e,t).then(function(e){if(e)return n=e.o,a=e.wnd,e})}}),$p.modifiers.push(function(e){var t=e.cch.properties;t.check_mandatory=function(t,n){var a,r;for(a in t)if(r=t[a],r.param.mandatory&&(!r.value||r.value.empty()))return e.msg.show_msg({type:"alert-error",text:e.msg.bld_empty_param+r.param.presentation,title:n||e.msg.bld_title}),!0},t.slist=function(t,n){var a,r,i,o=[],s=this.get(t);if(s&&s.type.is_ref)for(a in s.type.types)s.type.types[a].indexOf(".")>-1&&(r=s.type.types[a].split("."),i=e[r[0]][r[1]],i&&(n&&(n.mgr=i),"enm.open_directions"==i.class_name?i.get_option_list().forEach(function(t){t.value&&t.value!=e.enm.tso.folding&&o.push(t)}):i.class_name.indexOf("enm.")==-1&&i.metadata().has_owners?i.find_rows({owner:t},function(e){o.push({value:e.ref,text:e.presentation})}):o=i.get_option_list()));return o}}),$p.modifiers.push(function(e){var t=e.doc.buyers_order;t.on("after_create",function(t){var n=e.current_acl.acl_objs,a=this;return n.find_rows({by_default:!0,type:e.cat.organizations.metadata().obj_presentation||e.cat.organizations.metadata().name},function(e){return a.organization=e.acl_obj,!1}),n.find_rows({by_default:!0,type:e.cat.divisions.metadata().obj_presentation||e.cat.divisions.metadata().name},function(e){return a.department=e.acl_obj,!1}),n.find_rows({by_default:!0,type:e.cat.partners.metadata().obj_presentation||e.cat.partners.metadata().name},function(e){return a.partner=e.acl_obj,!1}),a.contract=e.cat.contracts.by_partner_and_org(a.partner,a.organization),a.manager=e.current_user,a.obj_delivery_state=e.enm.obj_delivery_states.Черновик,this.doc_currency=this.currency,a.new_number_doc()}),t.on("before_save",function(t){if(this.posted){if(this.obj_delivery_state==e.enm.obj_delivery_states.Отклонен||this.obj_delivery_state==e.enm.obj_delivery_states.Отозван||this.obj_delivery_state==e.enm.obj_delivery_states.Шаблон)return e.msg.show_msg({type:"alert-warning",text:"Нельзя провести заказ со статусом<br/>'Отклонён', 'Отозван' или 'Шаблон'",title:this.presentation}),!1;this.obj_delivery_state!=e.enm.obj_delivery_states.Подтвержден&&(this.obj_delivery_state=e.enm.obj_delivery_states.Подтвержден)}else this.obj_delivery_state==e.enm.obj_delivery_states.Подтвержден&&(this.obj_delivery_state=e.enm.obj_delivery_states.Отправлен);this.doc_amount=this.goods.aggregate([],["amount"]).round(2)+this.services.aggregate([],["amount"]).round(2),this._obj.partner_name=this.partner.name}),t.on("value_change",function(t){var n=function(){t.row.amount=(t.row.price*((100-(t.row.discount_percent+t.row.discount_percent_auto))/100)*t.row.quantity).round(2),this.doc_amount=this.goods.aggregate([],["amount"]).round(2)+this.services.aggregate([],["amount"]).round(2)}.bind(this);"organization"==t.field&&this.contract.organization!=t.value?this.contract=e.cat.contracts.by_partner_and_org(this.partner,t.value):"partner"==t.field&&this.contract.owner!=t.value?this.contract=e.cat.contracts.by_partner_and_org(t.value,this.organization):"goods"==t.tabular_section&&(t.row[t.field]=t.value,"nom"==t.field||"nom_characteristic"==t.field?("nom"!=t.field||t.row.nom_characteristic.empty()||t.row.nom_characteristic.owner==t.value||(t.row.nom_characteristic=""),t.row.price=t.row.nom._price({price_type:this.doc_price_type,characteristic:t.row.nom_characteristic,date:this.date,currency:this.currency}),n()):"price"!=t.field&&"quantity"!=t.field&&"discount_percent"!=t.field&&"discount_percent_internal"!=t.field||n())}),t._obj_constructor.prototype.__define({currency:{get:function(){var t=this.doc_currency.empty()?this.contract.settlements_currency:this.doc_currency;return t.empty()?e.job_prm.pricing.main_currency:t}},doc_price_type:{get:function(){var t=this.price_type.empty()?this.contract.price_type:this.price_type;return t._manager===e.cat.nom_prices_types_partners&&(t=t.nom_prices_type),t.empty()?e.job_prm.pricing.price_type_sale:t}},print_data:{get:function(){var t=this.organizational_unit&&!this.organizational_unit.empty()&&this.organizational_unit._manager==cat.organization_bank_accounts?this.organizational_unit:this.organization.main_bank_account,n=[],a={"АдресДоставки":this.shipping_address,"ВалютаДокумента":this.currency.presentation,"ДатаЗаказаФорматD":e.moment(this.date).format("L"),"ДатаЗаказаФорматDD":e.moment(this.date).format("LL"),"ДатаТекущаяФорматD":e.moment().format("L"),"ДатаТекущаяФорматDD":e.moment().format("LL"),"ДоговорДатаФорматD":e.moment(this.contract.date.valueOf()==e.utils.blank.date.valueOf()?this.date:this.contract.date).format("L"),"ДоговорДатаФорматDD":e.moment(this.contract.date.valueOf()==e.utils.blank.date.valueOf()?this.date:this.contract.date).format("LL"),"ДоговорНомер":this.contract.number_doc?this.contract.number_doc:this.number_doc,"ДоговорСрокДействия":e.moment(this.contract.validity).format("L"),"ЗаказНомер":this.number_doc,"Контрагент":this.partner.presentation,"КонтрагентОписание":this.partner.long_presentation,"КонтрагентДокумент":"","КонтрагентКЛДолжность":"","КонтрагентКЛДолжностьРП":"","КонтрагентКЛИмя":"","КонтрагентКЛИмяРП":"","КонтрагентКЛК":"","КонтрагентКЛОснованиеРП":"","КонтрагентКЛОтчество":"","КонтрагентКЛОтчествоРП":"","КонтрагентКЛФамилия":"","КонтрагентКЛФамилияРП":"","КонтрагентЮрФизЛицо":"","КратностьВзаиморасчетов":this.settlements_multiplicity,"КурсВзаиморасчетов":this.settlements_course,"ЛистКомплектацииГруппы":"","ЛистКомплектацииСтроки":"","Организация":this.organization.presentation,"ОрганизацияГород":this.organization.contact_information._obj.reduce(function(e,t){return e||t.city},"")||"Москва","ОрганизацияАдрес":this.organization.contact_information._obj.reduce(function(t,n){return n.kind==e.cat.contact_information_kinds.predefined("ЮрАдресОрганизации")&&n.presentation?n.presentation:t?t:!n.presentation||n.kind!=e.cat.contact_information_kinds.predefined("ФактАдресОрганизации")&&n.kind!=e.cat.contact_information_kinds.predefined("ПочтовыйАдресОрганизации")?void 0:n.presentation},""),"ОрганизацияТелефон":this.organization.contact_information._obj.reduce(function(t,n){return n.kind==e.cat.contact_information_kinds.predefined("ТелефонОрганизации")&&n.presentation?n.presentation:t?t:n.kind==e.cat.contact_information_kinds.predefined("ФаксОрганизации")&&n.presentation?n.presentation:void 0},""),"ОрганизацияБанкБИК":t.bank.id,"ОрганизацияБанкГород":t.bank.city,"ОрганизацияБанкКоррСчет":t.bank.correspondent_account,"ОрганизацияБанкНаименование":t.bank.name,"ОрганизацияБанкНомерСчета":t.account_number,"ОрганизацияИндивидуальныйПредприниматель":this.organization.individual_entrepreneur.presentation,"ОрганизацияИНН":this.organization.inn,"ОрганизацияКПП":this.organization.kpp,"ОрганизацияСвидетельствоДатаВыдачи":this.organization.certificate_date_issue,"ОрганизацияСвидетельствоКодОргана":this.organization.certificate_authority_code,"ОрганизацияСвидетельствоНаименованиеОргана":this.organization.certificate_authority_name,"ОрганизацияСвидетельствоСерияНомер":this.organization.certificate_series_number,"ОрганизацияЮрФизЛицо":this.organization.individual_legal.presentation,"ПродукцияЭскизы":{},"Проект":this.project.presentation,"СистемыПрофилей":this.sys_profile,"СистемыФурнитуры":this.sys_furn,"Сотрудник":this.manager.presentation,"СотрудникДолжность":this.manager.individual_person.Должность||"менеджер","СотрудникДолжностьРП":this.manager.individual_person.ДолжностьРП,"СотрудникИмя":this.manager.individual_person.Имя,"СотрудникИмяРП":this.manager.individual_person.ИмяРП,"СотрудникОснованиеРП":this.manager.individual_person.ОснованиеРП,"СотрудникОтчество":this.manager.individual_person.Отчество,"СотрудникОтчествоРП":this.manager.individual_person.ОтчествоРП,"СотрудникФамилия":this.manager.individual_person.Фамилия,"СотрудникФамилияРП":this.manager.individual_person.ФамилияРП,"СотрудникФИО":this.manager.individual_person.Фамилия+(this.manager.individual_person.Имя?" "+this.manager.individual_person.Имя[1].toUpperCase()+".":"")+(this.manager.individual_person.Отчество?" "+this.manager.individual_person.Отчество[1].toUpperCase()+".":""),"СотрудникФИОРП":this.manager.individual_person.ФамилияРП+" "+this.manager.individual_person.ИмяРП+" "+this.manager.individual_person.ОтчествоРП,"СуммаДокумента":this.doc_amount.toFixed(2),"СуммаДокументаПрописью":this.doc_amount.in_words(),"СуммаДокументаБезСкидки":this.goods._obj.reduce(function(e,t){return e+t.quantity*t.price},0).toFixed(2)+this.service._obj.reduce(function(e,t){return e+t.quantity*t.price},0).toFixed(2),"СуммаСкидки":this.goods._obj.reduce(function(e,t){return e+t.discount},0).toFixed(2)+this.servise._obj.reduce(function(e,t){return e+t.discount},0).toFixed(2),"СуммаНДС":this.goods._obj.reduce(function(e,t){return e+t.vat_amount},0).toFixed(2)+this.servise._obj.reduce(function(e,t){return e+t.vat_amount},0).toFixed(2),"ТекстНДС":this.vat_consider?this.vat_included?"В том числе НДС 18%":"НДС 18% (сверху)":"Без НДС","ТелефонПоАдресуДоставки":this.phone,"СуммаВключаетНДС":this.contract.vat_included,"УчитыватьНДС":this.contract.vat_consider,"ВсегоНаименований":this.goods.count()+this.service.count(),"ВсегоИзделий":0,"ВсегоПлощадьИзделий":0};this.extra_fields.forEach(function(e){a["Свойство"+e.property.name.replace(/\s/g,"")]=e.value.presentation||e.value}),this.shipping_address?a.МонтажДоставкаСамовывоз="Монтаж по адресу: "+this.shipping_address:a.МонтажДоставкаСамовывоз="Самовывоз";for(var r in this.organization._attachments)if(r.indexOf("logo")!=-1){n.push(this.organization.get_attachment(r).then(function(t){return e.utils.blob_as_text(t,t.type.indexOf("svg")==-1?"data_url":"")}).then(function(e){a.ОрганизацияЛоготип=e})["catch"](e.record_log));break}return(n.length?Promise.all(n):Promise.resolve([])).then(function(){if(!window.QRCode)return new Promise(function(t,n){e.load_script("lib/qrcodejs/qrcode.js","script",t)})}).then(function(){var e=document.createElement("SVG");e.innerHTML="<g />";new QRCode(e,{text:"http://www.oknosoft.ru/zd/",width:100,height:100,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H,useSVG:!0});return a.qrcode=e.innerHTML,a})}},row_description:{value:function(e){var t=e.nom_characteristic,n={"НомерСтроки":e.row,"Количество":e.quantity,"Ед":e.unit.name||"шт","Цвет":t.clr.name,"Размеры":e.len+"x"+e.width+", "+e.s+"м²","Номенклатура":e.nom.name_full||e.nom.name,"Характеристика":t.name,"Заполнения":"","Цена":e.price,"ЦенаВнутр":e.price_internal,"СкидкаПроцент":e.discount_percent,"СкидкаПроцентВнутр":e.discount_percent_internal,"Скидка":e.discount,"Сумма":e.amount,"СуммаВнутр":e.amount_internal};return t.glasses.forEach(function(e){n.Заполнения.indexOf(e.nom.name)==-1&&(n.Заполнения&&(n.Заполнения+=", "),n.Заполнения+=e.nom.name)}),n}}})}),$p.modifiers.push(function(e){var t=e.doc.buyers_order;t.form_list=function(n,a){function r(t){function n(){switch(t){case"execution":e.doc.buyers_order.rep_invoice_execution(_);break;case"plan":case"underway":case"manufactured":case"executed":e.doc.buyers_order.rep_planing(_,t)}}s.cells("report").setActive(),_?_._online&&n():_=new e.HandsontableDocument(s.cells("report"),{}).then(function(e){return e._online?void n():_=null})}a||(a={hide_header:!0,date_from:new Date((new Date).getFullYear().toFixed()+"-01-01"),date_till:new Date((new Date).getFullYear().toFixed()+"-12-31"),on_new:function(n){e.iface.set_hash(t.class_name,n.ref)},on_edit:function(t,n){e.iface.set_hash(t.class_name,n)}});var i=n.attachLayout({pattern:"2U",cells:[{id:"a",text:"Фильтр",collapsed_text:"Фильтр",width:180},{id:"b",text:"Заказы",header:!1}],offsets:{top:0,right:0,bottom:0,left:0}}),o=i.cells("a").attachTree(),s=i.cells("b").attachCarousel({keys:!1,touch_scroll:!1,offset_left:0,offset_top:0,offset_item:0});s.hideControls(),s.addCell("list"),s.addCell("report"),s.conf.anim_step=200,s.conf.anim_slide="left 0.1s";var _,l=t.form_selection(s.cells("list"),a),c={},d={};return c.__define({value:{get:function(){switch(o.getSelectedItemId()){case"draft":case"sent":case"declined":case"confirmed":case"zarchive":return"doc/doc_buyers_order_date";case"execution":case"all":return""}}}}),d.__define({value:{get:function(){var e,t;switch(t=o.getSelectedItemId()){case"draft":case"sent":case"declined":case"confirmed":case"zarchive":e=t;break;case"execution":case"all":return""}var n=l.elmnts.filter.get_filter(!0);return{startkey:[e,n.date_from.getFullYear(),n.date_from.getMonth()+1,n.date_from.getDate()],endkey:[e,n.date_till.getFullYear(),n.date_till.getMonth()+1,n.date_till.getDate()],_drop_date:!0,_order_by:!0,_search:n.filter.toLowerCase()}}}}),l.elmnts.filter.custom_selection._view=c,l.elmnts.filter.custom_selection._key=d,o.enableTreeImages(!1),o.parse(e.injected_data["tree_filteres.xml"]),o.attachEvent("onSelect",function(e){switch(e){case"draft":case"sent":case"declined":case"confirmed":case"zarchive":case"all":return s.cells("list").setActive(),void l.elmnts.filter.call_event()}r(e)}),l}}),$p.modifiers.push(function(e){var t=e.doc.buyers_order;t.form_obj=function(n,a){function r(n){switch(n){case"btn_sent":o("sent");break;case"btn_save":o("save");break;case"btn_save_close":o("close");break;case"btn_retrieve":o("retrieve");break;case"btn_post":o("post");break;case"btn_unpost":o("unpost");break;case"btn_close":c.close();break;case"btn_add_builder":open_builder(!0);break;case"btn_add_product":e.dp.buyers_order.form_product_list(c,process_add_product);break;case"btn_add_material":add_material();break;case"btn_edit":open_builder();break;case"btn_spec":open_spec();break;case"btn_discount":break;case"btn_go_connection":i()}"prn_"==n.substr(0,4)&&t.print(l,n,c)}function i(){e.msg.show_not_implemented()}function o(t){function n(n){c.elmnts.ro||(l.note=c.elmnts.cell_note.cell.querySelector("textarea").value.replace(/&nbsp;/g," ").replace(/<.*?>/g,"").replace(/&.{2,6};/g,""),c.elmnts.pg_left.selectRow(0)),l.save(n).then(function(){"sent"==t||"close"==t?c.close():(c.set_text(),_())})["catch"](function(t){e.record_log(t)})}"sent"==t?dhtmlx.confirm({title:e.msg.order_sent_title,text:e.msg.order_sent_message,cancel:e.msg.cancel,callback:function(t){t&&(l.obj_delivery_state=e.enm.obj_delivery_states.Отправлен,n())}}):"retrieve"==t?(l.obj_delivery_state=e.enm.obj_delivery_states.Отозван,n()):"save"==t||"close"==t?n():"post"==t?n(!0):"unpost"==t&&n(!1)}function s(){return["vault","vault_pop","discount","discount_pop"].forEach(function(e){c&&c.elmnts&&c.elmnts[e]&&c.elmnts[e].unload&&c.elmnts[e].unload()}),d.forEach(function(t){e.eve.detachEvent(t)}),"function"==typeof A&&A(),!0}function _(){var t,n,a=e.enm.obj_delivery_states.Черновик,r=e.enm.obj_delivery_states.Отозван;c.elmnts.pg_right.cells("vat_consider",1).setDisabled(!0),c.elmnts.pg_right.cells("vat_included",1).setDisabled(!0),c.elmnts.ro=!1,l.obj_delivery_state==e.enm.obj_delivery_states.Шаблон?c.elmnts.ro=!e.current_acl.role_available("МенеджерПоПродажам"):l.posted||l._deleted?c.elmnts.ro=!e.current_acl.role_available("МенеджерПоПродажам"):c.elmnts.ro||l.obj_delivery_state.empty()||(c.elmnts.ro=l.obj_delivery_state!=a&&l.obj_delivery_state!=r),t=!l._deleted&&(l.obj_delivery_state==e.enm.obj_delivery_states.Отправлен||l.obj_delivery_state==e.enm.obj_delivery_states.Отклонен),c.elmnts.grids.goods.setEditable(!c.elmnts.ro),c.elmnts.pg_left.setEditable(!c.elmnts.ro),c.elmnts.pg_right.setEditable(!c.elmnts.ro),e.current_acl.role_available("МенеджерПоПродажам")||(c.elmnts.frm_toolbar.hideItem("btn_post"),c.elmnts.frm_toolbar.hideItem("btn_unpost")),c.elmnts.ro?(c.elmnts.frm_toolbar.disableItem("btn_sent"),c.elmnts.frm_toolbar.disableItem("btn_save"),n=c.elmnts.tabs.tab_goods.getAttachedToolbar(),n.forEachItem(function(e){n.disableItem(e)})):(l.obj_delivery_state==e.enm.obj_delivery_states.Шаблон?c.elmnts.frm_toolbar.disableItem("btn_sent"):c.elmnts.frm_toolbar.enableItem("btn_sent"),c.elmnts.frm_toolbar.enableItem("btn_save"),n=c.elmnts.tabs.tab_goods.getAttachedToolbar(),n.forEachItem(function(e){n.enableItem(e)})),t?c.elmnts.frm_toolbar.enableListOption("bs_more","btn_retrieve"):c.elmnts.frm_toolbar.disableListOption("bs_more","btn_retrieve")}var l,c,d=[],A=a.on_close;return a.draw_pg_header=function(t,n){function a(){setTimeout(function(){n.elmnts.layout_header.setSizes&&(n.elmnts.layout_header.setSizes(),n.elmnts.pg_left.objBox.style.width="100%",n.elmnts.pg_right.objBox.style.width="100%")},200)}setTimeout(_,50),n.elmnts.layout_header=n.elmnts.tabs.tab_header.attachLayout("3U"),n.elmnts.layout_header.attachEvent("onResizeFinish",a),n.elmnts.layout_header.attachEvent("onPanelResizeFinish",a),n.elmnts.cell_left=n.elmnts.layout_header.cells("a"),n.elmnts.cell_left.hideHeader(),n.elmnts.pg_left=n.elmnts.cell_left.attachHeadFields({obj:t,pwnd:n,read_only:n.elmnts.ro,oxml:{" ":[{id:"number_doc",path:"o.number_doc",synonym:"Номер",type:"ro",txt:t.number_doc},{id:"date",path:"o.date",synonym:"Дата",type:"ro",txt:e.moment(t.date).format(e.moment._masks.date_time)}],"Контактная информация":["partner",{id:"shipping_address",path:"o.shipping_address",synonym:"Адрес доставки",type:"txt",txt:t.shipping_address}],"Дополнительные реквизиты":[{id:"obj_delivery_state",path:"o.obj_delivery_state",synonym:"Состояние транспорта",type:"ro",txt:t.obj_delivery_state.presentation}]}}),n.elmnts.cell_right=n.elmnts.layout_header.cells("b"),n.elmnts.cell_right.hideHeader(),n.elmnts.pg_right=n.elmnts.cell_right.attachHeadFields({obj:t,pwnd:n,read_only:n.elmnts.ro,oxml:{"Налоги":["vat_consider","vat_included"],"Аналитика":["project",{id:"organization",path:"o.organization",synonym:"Организация",type:"refc",txt:t.organization.presentation},"contract","organizational_unit","department"],"Итоги":[{id:"doc_currency",path:"o.doc_currency",synonym:"Валюта документа",type:"ro",txt:t.doc_currency.presentation},{id:"doc_amount",path:"o.doc_amount",synonym:"Сумма",type:"ron",txt:t.doc_amount}]}}),n.elmnts.cell_note=n.elmnts.layout_header.cells("c"),n.elmnts.cell_note.hideHeader(),n.elmnts.cell_note.setHeight(100),n.elmnts.cell_note.attachHTMLString("<textarea class='textarea_editor'>"+t.note+"</textarea>")},a.toolbar_struct=e.injected_data["toolbar_buyers_order_obj.xml"],a.toolbar_click=r,a.on_close=s,this.constructor.prototype.form_obj.call(this,n,a).then(function(e){if(e)return l=e.o,c=e.wnd,e})}}),$p.modifiers.push(function(e){e.doc.buyers_order.rep_invoice_execution=function(t){var n={reduce:!0,limit:1e4,group:!0,group_level:3},a={data:[],readOnly:!0,colWidths:[180,180,200,100,100,100,100,100],colHeaders:["Контрагент","Организация","Заказ","Сумма","Оплачено","Долг","Отгружено","Отгрузить"],columns:[{type:"text"},{type:"text"},{type:"text"},{type:"numeric",format:"0 0.00"},{type:"numeric",format:"0 0.00"},{type:"numeric",format:"0 0.00"},{type:"numeric",format:"0 0.00"},{type:"numeric",format:"0 0.00"}],wordWrap:!1};return e.current_acl.role_available("СогласованиеРасчетовЗаказов")||(n.startkey=[e.current_acl.partners_uids[0],""],n.endkey=[e.current_acl.partners_uids[0],"￿"]),e.wsql.pouch.remote.doc.query("server/invoice_execution",n).then(function(n){var r={invoice:0,pay:0,total_pay:0,shipment:0,total_shipment:0};return n.rows&&(n.rows.forEach(function(t){(t.value.total_pay||t.value.total_shipment)&&(a.data.push([e.cat.partners.get(t.key[0]).presentation,e.cat.organizations.get(t.key[1]).presentation,t.key[2],t.value.invoice,t.value.pay,t.value.total_pay,t.value.shipment,t.value.total_shipment]),r.invoice+=t.value.invoice,r.pay+=t.value.pay,r.total_pay+=t.value.total_pay,r.shipment+=t.value.shipment,r.total_shipment+=t.value.total_shipment)}),a.data.push(["Итого:","","",r.invoice,r.pay,r.total_pay,r.shipment,r.total_shipment]),a.mergeCells=[{row:a.data.length-1,col:0,rowspan:1,colspan:3}]),t.requery(a),a})}}),$p.modifiers.push(function(e){function t(e){function t(){return e.doc.nom_prices_setup.pouch_db.query("doc/doc_nom_prices_setup_slice_last",{limit:1e3,include_docs:!1,startkey:[""],endkey:["￿"]}).then(function(t){t.rows.forEach(function(t){var n=e.cat.nom.get(t.key[0],!1,!0);n&&n._data&&(n._data._price||(n._data._price={}),n._data._price[t.key[1]]||(n._data._price[t.key[1]]={}),n._data._price[t.key[1]][t.key[2]]||(n._data._price[t.key[1]][t.key[2]]=[]),n._data._price[t.key[1]][t.key[2]].push({date:new Date(t.value.date),price:t.value.price,currency:e.cat.currencies.get(t.value.currency)}))})})}this.from_currency_to_currency=function(t,n,a,r){if(r&&!r.empty()||(r=e.job_prm.pricing.main_currency),!a||a==r)return t;n||(n=new Date),this.cource_sql||(this.cource_sql=e.wsql.alasql.compile("select top 1 * from `ireg_currency_courses` where `currency` = ? and `period` <= ? order by `date` desc"));var i,o={course:1,multiplicity:1},s={course:1,multiplicity:1};return a!=e.job_prm.pricing.main_currency&&(i=this.cource_sql([a.ref,n]),i.length&&(o=i[0])),r!=e.job_prm.pricing.main_currency&&(i=this.cource_sql([r.ref,n]),i.length&&(s=i[0])),t*o.course/o.multiplicity*s.multiplicity/s.course},e.on({predefined_elmnts_inited:function n(){e.off(n),t()},pouch_change:function(t,n){t!=e.doc.nom_prices_setup.cachable}})}e.pricing=new t(e),e.cat.nom._obj_constructor.prototype.__define({_price:{value:function(t){t||(t={}),t.price_type?e.utils.is_data_obj(t.price_type)&&(t.price_type=t.price_type.ref):t.price_type=e.job_prm.pricing.price_type_sale,t.characteristic?e.utils.is_data_obj(t.characteristic)&&(t.characteristic=t.characteristic.ref):t.characteristic=e.utils.blank.guid,t.date||(t.date=new Date);var n,a=0,r=e.utils.blank.date;return this._data._price&&(this._data._price[t.characteristic]?this._data._price[t.characteristic][t.price_type]&&this._data._price[t.characteristic][t.price_type].forEach(function(e){e.date>r&&e.date<=t.date&&(a=e.price,n=e.currency)}):t.characteristic!=e.utils.blank.guid&&this._data._price[e.utils.blank.guid]&&this._data._price[e.utils.blank.guid][t.price_type]&&this._data._price[e.utils.blank.guid][t.price_type].forEach(function(e){e.date>r&&e.date<=t.date&&(a=e.price,n=e.currency)})),e.pricing.from_currency_to_currency(a,t.date,n,t.currency)}}})}),$p.injected_data._mixin({"view_about.html":'<div class="md_column1300">\r\n    <h1><i class="fa fa-info-circle"></i> Заказы онлайн</h1>\r\n    <p>Заказы онлайн - это веб-приложение на базе фреймворка <a href="http://www.oknosoft.ru/metadata/" target="_blank">Metadata.js</a><br />\r\n        Исходный код и документация доступны на <a href="https://github.com/oknosoft/order-online" target="_blank">GitHub <i class="fa fa-github-alt"></i></a>.<br />\r\n    </p>\r\n\r\n    <h3>Назначение и возможности</h3>\r\n    <ul>\r\n        <li>Создание и редактирование документов <i>Заказ покупателя</i> для типовых конфигураций 1С</li>\r\n        <li>Заказы формируются с тем же набором и типами полей, что и в стандартной 1С<br />(реплицируются справочники <i>Контрагенты, Партнеры, Договоры, Организации, Номенклатура, Характеристики, Серии, Склады</i> и т.д. -<br />все ссылочные типы, задействованные в подсистеме управления продажами)</li>\r\n        <li>Фоновый двусторонний обмен изменений объектов с ИБ 1С</li>\r\n        <li>Гибкая настройка видимости и доступности объектов и реквизитов для групп пользователей</li>\r\n        <li>Формирование печатных форм счетов и заказов</li>\r\n        <li>Формирование отчетов об оплате и отгрузке по заказам</li>\r\n        <li>Поддержка автономной работы при отсутствии доступа в Интернет и прозрачного обмена с сервером при возобновлении соединения</li>\r\n        <li>Синхронизация заказов не только базой поставщика, но так же и с учетными системами клиентов и дилеров</li>\r\n    </ul>\r\n\r\n    <h3>Использованы следующие библиотеки и инструменты:</h3>\r\n    <h4>Серверная часть</h4>\r\n    <ul>\r\n        <li><a href="http://couchdb.apache.org/" target="_blank">couchDB</a>, NoSQL база данных с поддержкой master-master репликации</li>\r\n        <li><a href="http://nginx.org/ru/" target="_blank">nginx</a>, высокопроизводительный HTTP-сервер</li>\r\n        <li><a href="http://1c-dn.com/1c_enterprise/" target="_blank">1c_enterprise</a>, ORM сервер 1С:Предприятие</li>\r\n    </ul>\r\n\r\n    <h4>Управление данными в памяти браузера</h4>\r\n    <ul>\r\n        <li><a href="https://pouchdb.com/" target="_blank">pouchDB</a>, клиентская NoSQL база данных с поддержкой автономной работы и репликации с CouchDB</li>\r\n        <li><a href="https://github.com/agershun/alasql" target="_blank">alaSQL</a>, база данных SQL для браузера и Node.js с поддержкой как традиционных реляционных таблиц, так и вложенных JSON данных (NoSQL)</li>\r\n    </ul>\r\n\r\n    <h4>UI библиотеки и компоненты интерфейса</h4>\r\n    <ul>\r\n        <li><a href="http://dhtmlx.com/" target="_blank">dhtmlx</a>, кроссбраузерная библиотека javascript для построения современных веб и мобильных приложений</li>\r\n        <li><a href="https://handsontable.com/" target="_blank">handsontable</a>, компонент для отображения и редактирования табличных данных</li>\r\n        <li><a href="https://github.com/eligrey/FileSaver.js" target="_blank">filesaver.js</a>, HTML5 реализация метода saveAs</li>\r\n        <li><a href="http://momentjs.com/" target="_blank">moment.js</a>, библиотека форматирования интервалов и дат</li>\r\n        <li><a href="https://github.com/SheetJS/js-xlsx" target="_blank">xlsx</a>, библиотека для чтения и записи XLSX / XLSM / XLSB / XLS / ODS в браузере</li>\r\n    </ul>\r\n\r\n    <h4>Графика</h4>\r\n    <ul>\r\n        <li><a href="https://fortawesome.github.io/Font-Awesome/" target="_blank">fontawesome</a>, набор шрифтовых иконок</li>\r\n    </ul>\r\n\r\n    <h3>Лицензия</h3>\r\n    <p>Для некоммерческих Open Source проектов, разрешено использование и распространение исходного кода приложения\r\n        <a href="https://github.com/oknosoft/order-online" target="_blank">Заказы онлайн</a> и библиотеки\r\n        <a href="http://www.oknosoft.ru/metadata/" target="_blank">Metadata.js</a><br />на условиях\r\n        <a href="http://www.gnu.org/licenses/agpl.html" target="_blank">GNU Affero General Public License v.3</a>.<br />\r\n        Коммерческая <a href="http://www.oknosoft.ru/programmi-oknosoft/metadata.html" target="_blank">лицензия на разработчика</a> позволяет использовать и распространять ПО в любом количестве неконкурирующих продуктов, без ограничений на количество копий\r\n    </p>\r\n\r\n    <h3><i class="fa fa-question-circle"></i> Вопросы</h3>\r\n    <p>Если обнаружили ошибку, пожалуйста,\r\n        <a href="https://github.com/oknosoft/order-online/issues/new" target="_blank">зарегистрируйте вопрос в GitHub</a> или\r\n        <a href="http://www.oknosoft.ru/metadata/#page-118" target="_blank">свяжитесь с разработчиком</a> напрямую<br /></p>\r\n    <p>&nbsp;</p>\r\n\r\n</div>',
"view_settings.html":'<div class="md_column1300">\r\n\r\n    <div class="md_column320" name="form1" style="max-width: 400px;"><div></div></div>\r\n\r\n    <div class="md_column320" name="form2" style="max-width: 400px;"><div></div></div>\r\n\r\n</div>',"toolbar_buyers_order_obj.xml":'<?xml version="1.0" encoding=\'utf-8\'?>\r\n<toolbar>\r\n    <item id="sep0" type="separator"/>\r\n    <item type="button" id="btn_save_close" text="&lt;i class=\'fa fa-caret-square-o-down fa-fw\'&gt;&lt;/i&gt;" title="Записать и закрыть"/>\r\n    <item type="button" id="btn_save" text="&lt;i class=\'fa fa-floppy-o fa-fw\'&gt;&lt;/i&gt;" title="Записать"/>\r\n    <item type="button" id="btn_sent" text="&lt;i class=\'fa fa-paper-plane-o fa-fw\'&gt;&lt;/i&gt;" title="Отправить заказ" />\r\n\r\n    <item type="button" id="btn_post" enabled="false" text="&lt;i class=\'fa fa-check-square-o fa-fw\'&gt;&lt;/i&gt;" title="Провести документ" />\r\n    <item type="button" id="btn_unpost" enabled="false" text="&lt;i class=\'fa fa-square-o fa-fw\'&gt;&lt;/i&gt;" title="Отмена проведения" />\r\n\r\n    <item type="button" id="btn_files" text="&lt;i class=\'fa fa-paperclip fa-fw\'&gt;&lt;/i&gt;" title="Присоединенные файлы"/>\r\n\r\n    <item type="buttonSelect" id="bs_print" text="&lt;i class=\'fa fa-print fa-fw\'&gt;&lt;/i&gt;" title="Печать" openAll="true">\r\n    </item>\r\n\r\n    <item type="buttonSelect" id="bs_create_by_virtue" text="&lt;i class=\'fa fa-bolt fa-fw\'&gt;&lt;/i&gt;" title="Создать на основании" openAll="true" >\r\n        <item type="button" id="btn_message" enabled="false" text="Сообщение" />\r\n    </item>\r\n\r\n    <item type="buttonSelect" id="bs_go_to" text="&lt;i class=\'fa fa-external-link fa-fw\'&gt;&lt;/i&gt;" title="Перейти" openAll="true" >\r\n        <item type="button" id="btn_go_connection" enabled="false" text="Связи" />\r\n    </item>\r\n\r\n    <item type="buttonSelect"   id="bs_more"  text="&lt;i class=\'fa fa-th-large fa-fw\'&gt;&lt;/i&gt;"  title="Дополнительно" openAll="true">\r\n        <item type="button"     id="btn_retrieve"    text="&lt;i class=\'fa fa-undo fa-fw\'&gt;&lt;/i&gt; Отозвать" title="Отозвать заказ" />\r\n        <item type="separator"  id="sep_export" />\r\n        <item type="button" id="btn_import" text="&lt;i class=\'fa fa-upload fa-fw\'&gt;&lt;/i&gt; Загрузить из файла" />\r\n        <item type="button" id="btn_export" text="&lt;i class=\'fa fa-download fa-fw\'&gt;&lt;/i&gt; Выгрузить в файл" />\r\n    </item>\r\n\r\n    <item id="sep_close_1" type="separator"/>\r\n    <item type="button" id="btn_close" text="&lt;i class=\'fa fa-times fa-fw\'&gt;&lt;/i&gt;" title="Закрыть форму"/>\r\n    <item id="sep_close_2" type="separator"/>\r\n\r\n</toolbar>',"tree_filteres.xml":'<?xml version="1.0" encoding="utf-8"?>\r\n<tree id="0">\r\n    <item id="draft" text="&lt;i class=\'fa fa-pencil fa-fw\'&gt;&lt;/i&gt; Черновики" select="1" tooltip="Предварительные расчеты"/>\r\n    <item id="sent" text="&lt;i class=\'fa fa-paper-plane-o fa-fw\'&gt;&lt;/i&gt; Отправлено" tooltip="Отправленные, но еще не принятые в работу. Могут быть отозваны (переведены в \'черновики\')" />\r\n    <item id="confirmed" text="&lt;i class=\'fa fa-thumbs-o-up fa-fw\'&gt;&lt;/i&gt; Согласовано" tooltip="Включены в план производства. Могут быть изменены менеджером. Недоступны для изменения дилером" />\r\n    <item id="declined" text="&lt;i class=\'fa fa-thumbs-o-down fa-fw\'&gt;&lt;/i&gt; Отклонено" tooltip="Не приняты в работу по техническим причинам. Требуется изменение конструктива или комплектации" />\r\n    <item id="execution" text="&lt;i class=\'fa fa-money fa-fw\'&gt;&lt;/i&gt; Долги" tooltip="Оплата, отгрузка" />\r\n    <item id="zarchive" text="&lt;i class=\'fa fa-archive fa-fw\'&gt;&lt;/i&gt; Архив" tooltip="Старые заказы" />\r\n    <item id="all" text="&lt;i class=\'fa fa-expand fa-fw\'&gt;&lt;/i&gt; Все" tooltip="Отключить фильтрацию" />\r\n</tree>\r\n',"create_tables.sql":"USE md;\nCREATE TABLE IF NOT EXISTS `ireg_$log` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, `date` INT, `sequence` INT, `class` CHAR, `note` CHAR, `obj` CHAR);\nCREATE TABLE IF NOT EXISTS `doc_nom_prices_setup` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, posted boolean, date Date, number_doc CHAR, `note` CHAR, `responsible` CHAR, `НеПроводитьНулевыеЗначения` BOOLEAN, `Информация` CHAR, `ts_goods` JSON, `ts_ТипыЦен` JSON);\nCREATE TABLE IF NOT EXISTS `doc_credit_cash_order` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, posted boolean, date Date, number_doc CHAR, `organization` CHAR, `Касса` CHAR, `department` CHAR, `responsible` CHAR, `Выдать` CHAR, `Основание` CHAR, `contract` CHAR, `ВалютаВзаиморасчетовРаботника` CHAR, `doc_currency` CHAR, `Приложение` CHAR, `ДатаПогашенияАванса` Date, `РасчетныйДокумент` CHAR, `РасчетныйДокумент_T` CHAR, `ПоДокументу` CHAR, `ОтражатьВУправленческомУчете` BOOLEAN, `accounting_reflect` BOOLEAN, `note` CHAR, `ОтраженоВОперУчете` BOOLEAN, `Оплачено` BOOLEAN, `partner` CHAR, `partner_T` CHAR, `ВидОперации` CHAR, `doc_amount` FLOAT, `ДокументОснование` CHAR, `ДокументОснование_T` CHAR, `tax_accounting_reflect` BOOLEAN, `СубконтоДт1` CHAR, `СубконтоДт1_T` CHAR, `СубконтоДт2` CHAR, `СубконтоДт2_T` CHAR, `СубконтоДт3` CHAR, `СубконтоДт3_T` CHAR, `СчетУчетаРасчетовСКонтрагентом` CHAR, `cash_flow_article` CHAR, `СчетОрганизации` CHAR, `Содержание_УСН` CHAR, `Графа4_УСН` FLOAT, `Графа5_УСН` FLOAT, `Графа6_УСН` FLOAT, `Графа7_УСН` FLOAT, `ДоходыЕНВД_УСН` BOOLEAN, `РасходыЕНВД_УСН` BOOLEAN, `НДС_УСН` FLOAT, `РучнаяНастройка_УСН` BOOLEAN, `ВидВыдачиДенежныхСредств` CHAR, `ОбъявлениеНаВзносНаличными` CHAR, `НомерЧекаККМ` INT, `СчетУчетаРасчетовСКонтрагентомНУ` CHAR, `СубконтоНУДт1` CHAR, `СубконтоНУДт1_T` CHAR, `СубконтоНУДт2` CHAR, `СубконтоНУДт2_T` CHAR, `СубконтоНУДт3` CHAR, `СубконтоНУДт3_T` CHAR, `ts_ВыплатаЗаработнойПлаты` JSON, `ts_РасшифровкаПлатежа` JSON, `ts_ВыплатаДепонентов` JSON, `ts_individuals` JSON);\nCREATE TABLE IF NOT EXISTS `doc_debit_cash_order` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, posted boolean, date Date, number_doc CHAR, `organization` CHAR, `Касса` CHAR, `department` CHAR, `ВидОперации` CHAR, `partner` CHAR, `partner_T` CHAR, `contract` CHAR, `ВалютаВзаиморасчетовПодотчетника` CHAR, `doc_currency` CHAR, `doc_amount` FLOAT, `ПринятоОт` CHAR, `Основание` CHAR, `Приложение` CHAR, `responsible` CHAR, `ОтраженоВОперУчете` BOOLEAN, `Оплачено` BOOLEAN, `note` CHAR, `ОтражатьВУправленческомУчете` BOOLEAN, `ДокументОснование` CHAR, `ДокументОснование_T` CHAR, `accounting_reflect` BOOLEAN, `РасчетныйДокумент` CHAR, `РасчетныйДокумент_T` CHAR, `tax_accounting_reflect` BOOLEAN, `СчетУчетаРасчетовСКонтрагентом` CHAR, `СубконтоКт1` CHAR, `СубконтоКт1_T` CHAR, `СубконтоКт2` CHAR, `СубконтоКт2_T` CHAR, `СубконтоКт3` CHAR, `СубконтоКт3_T` CHAR, `СчетОрганизации` CHAR, `cash_flow_article` CHAR, `vat_rate` CHAR, `Содержание_УСН` CHAR, `Графа4_УСН` FLOAT, `Графа5_УСН` FLOAT, `Графа6_УСН` FLOAT, `Графа7_УСН` FLOAT, `ДоходыЕНВД_УСН` BOOLEAN, `РасходыЕНВД_УСН` BOOLEAN, `НДС_УСН` FLOAT, `РучнаяНастройка_УСН` BOOLEAN, `ВыручкаСНТТ` BOOLEAN, `НомерЧекаККМ` INT, `ВидПриемаРозничнойВыручки` CHAR, `ДенежныйЧек` CHAR, `ts_РасшифровкаПлатежа` JSON);\nCREATE TABLE IF NOT EXISTS `doc_credit_bank_order` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, posted boolean, date Date, number_doc CHAR, `ДокументОснование` CHAR, `ДокументОснование_T` CHAR, `organization` CHAR, `СчетОрганизации` CHAR, `partner` CHAR, `ДатаОплаты` Date, `СчетКонтрагента` CHAR, `contract` CHAR, `ВидПлатежа` CHAR, `ОчередностьПлатежа` INT, `НазначениеПлатежа` CHAR, `ТекстПлательщика` CHAR, `doc_currency` CHAR, `ТекстПолучателя` CHAR, `note` CHAR, `Оплачено` BOOLEAN, `ИННПлательщика` CHAR, `КПППлательщика` CHAR, `ИННПолучателя` CHAR, `КПППолучателя` CHAR, `responsible` CHAR, `accounting_reflect` BOOLEAN, `КодБК` CHAR, `ОтраженоВОперУчете` BOOLEAN, `КодОКАТО` CHAR, `ПоказательДаты` Date, `ПоказательНомера` CHAR, `ПоказательОснования` CHAR, `ПоказательПериода` CHAR, `ПоказательТипа` CHAR, `СтатусСоставителя` CHAR, `doc_amount` FLOAT, `ВидОперации` CHAR, `cash_flow_article` CHAR, `СчетУчетаРасчетовСКонтрагентом` CHAR, `СубконтоДт1` CHAR, `СубконтоДт1_T` CHAR, `СубконтоДт2` CHAR, `СубконтоДт2_T` CHAR, `СубконтоДт3` CHAR, `СубконтоДт3_T` CHAR, `tax_accounting_reflect` BOOLEAN, `ФизЛицо` CHAR, `ДоговорЗайма` CHAR, `ВалютаВзаиморасчетовРаботника` CHAR, `ЧастичнаяОплата` BOOLEAN, `Содержание_УСН` CHAR, `Графа4_УСН` FLOAT, `Графа5_УСН` FLOAT, `Графа6_УСН` FLOAT, `Графа7_УСН` FLOAT, `ДоходыЕНВД_УСН` BOOLEAN, `РасходыЕНВД_УСН` BOOLEAN, `НДС_УСН` FLOAT, `РучнаяНастройка_УСН` BOOLEAN, `department` CHAR, `СчетУчетаРасчетовСКонтрагентомНУ` CHAR, `СубконтоНУДт1` CHAR, `СубконтоНУДт1_T` CHAR, `СубконтоНУДт2` CHAR, `СубконтоНУДт2_T` CHAR, `СубконтоНУДт3` CHAR, `СубконтоНУДт3_T` CHAR, `ДатаПогашенияАванса` Date, `РасчетныйДокументРаботника` CHAR, `ПеречислениеВБюджет` BOOLEAN, `ВидПеречисленияВБюджет` CHAR, `ИдентификаторПлатежа` CHAR, `ts_ПеречислениеЗаработнойПлаты` JSON, `ts_РасшифровкаПлатежа` JSON, `ts_РеквизитыКонтрагента` JSON, `ts_Работники` JSON);\nCREATE TABLE IF NOT EXISTS `doc_debit_bank_order` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, posted boolean, date Date, number_doc CHAR, `doc_currency` CHAR, `ВидОперации` CHAR, `contract` CHAR, `ДокументОснование` CHAR, `ДокументОснование_T` CHAR, `note` CHAR, `partner` CHAR, `НомерВходящегоДокумента` CHAR, `ДатаВходящегоДокумента` Date, `Оплачено` BOOLEAN, `organization` CHAR, `responsible` CHAR, `ОтраженоВОперУчете` BOOLEAN, `tax_accounting_reflect` BOOLEAN, `ДатаОплаты` Date, `ЧастичнаяОплата` BOOLEAN, `cash_flow_article` CHAR, `СубконтоКт1` CHAR, `СубконтоКт1_T` CHAR, `accounting_reflect` BOOLEAN, `СубконтоКт2` CHAR, `СубконтоКт2_T` CHAR, `СубконтоКт3` CHAR, `СубконтоКт3_T` CHAR, `doc_amount` FLOAT, `СчетКонтрагента` CHAR, `СчетОрганизации` CHAR, `СчетУчетаРасчетовСКонтрагентом` CHAR, `Содержание_УСН` CHAR, `Графа4_УСН` FLOAT, `Графа5_УСН` FLOAT, `Графа6_УСН` FLOAT, `Графа7_УСН` FLOAT, `ДоходыЕНВД_УСН` BOOLEAN, `РасходыЕНВД_УСН` BOOLEAN, `НДС_УСН` FLOAT, `РучнаяНастройка_УСН` BOOLEAN, `department` CHAR, `НазначениеПлатежа` CHAR, `СчетУчетаРасчетовСКонтрагентомНУ` CHAR, `СубконтоНУКт1` CHAR, `СубконтоНУКт1_T` CHAR, `СубконтоНУКт2` CHAR, `СубконтоНУКт2_T` CHAR, `СубконтоНУКт3` CHAR, `СубконтоНУКт3_T` CHAR, `cost_item` CHAR, `nom_group` CHAR, `ПодразделениеЗатраты` CHAR, `ПодразделениеОрганизацииЗатраты` CHAR, `СуммаУслуг` FLOAT, `ts_РасшифровкаПлатежа` JSON, `ts_РеквизитыКонтрагента` JSON);\nCREATE TABLE IF NOT EXISTS `doc_debt_adjustment` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, posted boolean, date Date, number_doc CHAR, `organization` CHAR, `ВидОперации` CHAR, `department` CHAR, `КонтрагентДебитор` CHAR, `КонтрагентКредитор` CHAR, `ОтражатьВУправленческомУчете` BOOLEAN, `accounting_reflect` BOOLEAN, `note` CHAR, `responsible` CHAR, `tax_accounting_reflect` BOOLEAN, `doc_currency` CHAR, `КурсДокумента` FLOAT, `КратностьДокумента` INT, `contract` CHAR, `ИспользоватьВспомогательныйСчет` BOOLEAN, `СчетДт` CHAR, `СубконтоДт1` CHAR, `СубконтоДт1_T` CHAR, `СубконтоДт2` CHAR, `СубконтоДт2_T` CHAR, `СубконтоДт3` CHAR, `СубконтоДт3_T` CHAR, `СчетКт` CHAR, `СубконтоКт1` CHAR, `СубконтоКт1_T` CHAR, `СубконтоКт2` CHAR, `СубконтоКт2_T` CHAR, `СубконтоКт3` CHAR, `СубконтоКт3_T` CHAR, `СчетДтНУ` CHAR, `СубконтоДтНУ1` CHAR, `СубконтоДтНУ1_T` CHAR, `СубконтоДтНУ2` CHAR, `СубконтоДтНУ2_T` CHAR, `СубконтоДтНУ3` CHAR, `СубконтоДтНУ3_T` CHAR, `СчетКтНУ` CHAR, `СубконтоКтНУ1` CHAR, `СубконтоКтНУ1_T` CHAR, `СубконтоКтНУ2` CHAR, `СубконтоКтНУ2_T` CHAR, `СубконтоКтНУ3` CHAR, `СубконтоКтНУ3_T` CHAR, `ДокументОснование` CHAR, `ts_СуммыДолга` JSON);\nCREATE TABLE IF NOT EXISTS `doc_buyers_order` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, posted boolean, date Date, number_doc CHAR, `shipping_address` CHAR, `doc_currency` CHAR, `ВидОперации` CHAR, `ВремяНапоминания` Date, `ДатаОплаты` Date, `ДатаОтгрузки` Date, `contract` CHAR, `ИспользоватьПлановуюСебестоимость` BOOLEAN, `ИтогПлановаяСебестоимость` FLOAT, `note` CHAR, `partner` CHAR, `settlements_multiplicity` INT, `settlements_course` FLOAT, `НапомнитьОСобытии` BOOLEAN, `organization` CHAR, `responsible` CHAR, `accounting_reflect` BOOLEAN, `tax_accounting_reflect` BOOLEAN, `department` CHAR, `organizational_unit` CHAR, `organizational_unit_T` CHAR, `СкладГруппа` CHAR, `СкладГруппа_T` CHAR, `vat_included` BOOLEAN, `doc_amount` FLOAT, `price_type` CHAR, `vat_consider` BOOLEAN, `Грузополучатель` CHAR, `КонтактноеЛицоКонтрагента` CHAR, `УсловиеПродаж` CHAR, `ДополнениеКАдресуДоставки` CHAR, `ДокументОснование` CHAR, `ДокументОснование_T` CHAR, `Грузоотправитель` CHAR, `НомерПоДаннымПокупателя` CHAR, `ДатаПоДаннымПокупателя` Date, `УсловияДоставки` CHAR, `ДатаПоставки` Date, `obj_delivery_state` CHAR, `ts_goods` JSON, `ts_ВозвратнаяТара` JSON, `ts_services` JSON, `ts_materials` JSON, `ts_СоставНабора` JSON, `ts_ПараметрыВыпускаПродукции` JSON, `ts_extra_fields` JSON);\nCREATE TABLE IF NOT EXISTS `cat_price_groups` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `sequence` INT, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_characteristics` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `ОКП` CHAR, `Активная` BOOLEAN, `owner` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_ФП_ЛекарственныеФормы` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `cat_formulas` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `formula` CHAR, `leading_formula` CHAR, `condition_formula` BOOLEAN, `definition` CHAR, `template` CHAR, `parent` CHAR, `ts_params` JSON);\nCREATE TABLE IF NOT EXISTS `cat_individuals` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `ДатаРождения` Date, `ИНН` CHAR, `КодИМНС` CHAR, `note` CHAR, `СтраховойНомерПФР` CHAR, `Пол` CHAR, `МестоРождения` CHAR, `ОсновноеИзображение` CHAR, `МестоРожденияКодПоОКАТО` CHAR, `ГруппаДоступаФизическогоЛица` CHAR, `ЛьготаПриНачисленииПособий` CHAR, `ИмеетНаучныеТруды` BOOLEAN, `ИмеетИзобретения` BOOLEAN, `ПостоянноПроживалВКрыму18Марта2014Года` BOOLEAN, `Должность` CHAR, `Фамилия` CHAR, `Имя` CHAR, `Отчество` CHAR, `parent` CHAR, `ts_СоставСемьи` JSON, `ts_Образование` JSON, `ts_ТрудоваяДеятельность` JSON, `ts_ЗнаниеЯзыков` JSON, `ts_Профессии` JSON, `ts_Стажи` JSON, `ts_Награды` JSON, `ts_УченыеСтепени` JSON, `ts_УченыеЗвания` JSON);\nCREATE TABLE IF NOT EXISTS `cat_sale_conditions` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `cat_nom_prices_types_partners` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `price_currency` CHAR, `vat_price_included` BOOLEAN, `nom_prices_type` CHAR, `ОписаниеТипаЦеныНоменклатурыКонтрагента` CHAR, `note` CHAR, `owner` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_nom_prices_types` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `price_currency` CHAR, `БазовыйТипЦен` CHAR, `Рассчитывается` BOOLEAN, `discount_percent` FLOAT, `vat_price_included` BOOLEAN, `ПорядокОкругления` CHAR, `ОкруглятьВБольшуюСторону` BOOLEAN, `note` CHAR, `СпособРасчетаЦены` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_charge_discounts_types` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `currency` CHAR, `ДляВсейНоменклатуры` BOOLEAN, `discount_percent` FLOAT, `ЗначениеУсловия` CHAR, `ЗначениеУсловия_T` CHAR, `ОбщееВремяНачала` Date, `ОбщееВремяОкончания` Date, `ОграничениеСкидкиНаценки` FLOAT, `condition` CHAR, `quality` CHAR, `ДляВсехПолучателей` BOOLEAN, `ПоДнямНедели` BOOLEAN, `ВидСкидки` CHAR, `ts_ВремяПоДнямНедели` JSON);\nCREATE TABLE IF NOT EXISTS `cat_cost_items` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `cost_kind` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_cash_flow_articles` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_stores` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `note` CHAR, `ТипЦенРозничнойТорговли` CHAR, `department` CHAR, `ВидСклада` CHAR, `НомерСекции` INT, `РасчетРозничныхЦенПоТорговойНаценке` BOOLEAN, `Карантин` BOOLEAN, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_serial_numbers` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `owner` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_nom_series` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `СерийныйНомер` CHAR, `СрокГодности` Date, `НомерГТД` CHAR, `СтранаПроисхождения` CHAR, `ОсновноеИзображение` CHAR, `note` CHAR, `ТехническийНомер` CHAR, `ДатаИзготовления` Date, `department` CHAR, `ОжидаемоеКоличествоВыпуска` FLOAT, `ДатаЗапускаСерии` Date, `nom_characteristic` CHAR, `ЕдиницаМест` CHAR, `Изготовитель` CHAR, `ДатаИзготовленияСубстанции` Date, `МаршрутнаяКарта` CHAR, `ПроцентноеСодержание` FLOAT, `owner` CHAR, `ts_Спецификации` JSON);\nCREATE TABLE IF NOT EXISTS `cat_regions` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `note` CHAR, `КодРегиона` CHAR, `КодАдресногоЭлемента` INT, `ЖДСтанцияНазначения` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_projects` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `ДатаНачала` Date, `ДатаОкончания` Date, `responsible` CHAR, `definition` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_orders_closing_reasons` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `cat_users` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `ФизЛицо` CHAR, `ИдентификаторПользователяИБ` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_divisions` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `ВидПодразделения` CHAR, `ВидЦФО` CHAR, `main_project` CHAR, `main_project_T` CHAR, `sequence` INT, `warehouse` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_organizations` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `prefix` CHAR, `ИНН` CHAR, `КПП` CHAR, `РегистрационныйНомерПФР` CHAR, `ГоловнаяОрганизация` CHAR, `name_full` CHAR, `КодПоОКПО` CHAR, `КодПоОКАТО` CHAR, `КодИМНС` CHAR, `РайонныйКоэффициент` FLOAT, `individual_legal` CHAR, `ТерриториальныеУсловияПФР` CHAR, `ОсновнойБанковскийСчет` CHAR, `ВидСтавокЕСНиПФР` CHAR, `НаименованиеПлательщикаПриПеречисленииНалогов` CHAR, `ИностраннаяОрганизация` BOOLEAN, `ДатаРегистрации` Date, `КодОКОПФ` CHAR, `НаименованиеОКОПФ` CHAR, `КодОКФС` CHAR, `НаименованиеОКФС` CHAR, `СвидетельствоСерияНомер` CHAR, `СвидетельствоДатаВыдачи` Date, `СвидетельствоНаименованиеОргана` CHAR, `СвидетельствоКодОргана` CHAR, `СтранаРегистрации` CHAR, `СтранаПостоянногоМестонахождения` CHAR, `КодВСтранеРегистрации` CHAR, `ОГРН` CHAR, `НаименованиеИнострОрганизации` CHAR, `РегистрационныйНомерФСС` CHAR, `НаименованиеИМНС` CHAR, `КодОКВЭД` CHAR, `НаименованиеОКВЭД` CHAR, `КодОКОНХ` CHAR, `ИндивидуальныйПредприниматель` CHAR, `ОбменКодАбонента` CHAR, `ОбменКаталогОтправкиДанныхОтчетности` CHAR, `ОбменКаталогПрограммыЭлектроннойПочты` CHAR, `РайонныйКоэффициентРФ` FLOAT, `ОтражатьВРегламентированномУчете` BOOLEAN, `КодИФНСПолучателя` CHAR, `НаименованиеТерриториальногоОрганаПФР` CHAR, `НаименованиеСокращенное` CHAR, `ВидОбменаСКонтролирующимиОрганами` CHAR, `УчетнаяЗаписьОбмена` CHAR, `КодОрганаПФР` CHAR, `КодОрганаФСГС` CHAR, `ДополнительныйКодФСС` CHAR, `КодПодчиненностиФСС` CHAR, `ЦифровойИндексОбособленногоПодразделения` INT, `РегистрационныйНомерТФОМС` CHAR, `ИПРегистрационныйНомерПФР` CHAR, `ИПРегистрационныйНомерФСС` CHAR, `ИПКодПодчиненностиФСС` CHAR, `ИПРегистрационныйНомерТФОМС` CHAR, `НаименованиеТерриториальногоОрганаФСС` CHAR, `КодПоОКТМО` CHAR, `Регион` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_gtd_numbers` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `note` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_nom_groups` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `storage_unit` CHAR, `base_unit` CHAR, `vat_rate` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_nom` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `article` CHAR, `ВестиОперативныйУчетОстатковНЗП` BOOLEAN, `ВестиУчетПоСериям` BOOLEAN, `ВестиУчетПоСериямВНЗП` BOOLEAN, `ВестиУчетПоХарактеристикам` BOOLEAN, `nom_kind` CHAR, `ЕдиницаДляОтчетов` CHAR, `storage_unit` CHAR, `base_unit` CHAR, `Набор` BOOLEAN, `vat_rate` CHAR, `note` CHAR, `Услуга` BOOLEAN, `nom_group` CHAR, `СтранаПроисхождения` CHAR, `НомерГТД` CHAR, `ТребуетсяВнешняяСертификация` BOOLEAN, `ТребуетсяВнутренняяСертификация` BOOLEAN, `cost_item` CHAR, `ВестиСерийныеНомера` BOOLEAN, `Комплект` BOOLEAN, `price_group` CHAR, `piece_unit` CHAR, `Производитель` CHAR, `Импортер` CHAR, `ПроцентСрокаГодности` INT, `ВремяПроверкиЗаказа` INT, `МинимальнаяПартияЗакупки` FLOAT, `ЦиклПоставкиДней` INT, `РегистрационныйНомер` CHAR, `ФормулаОсновногоДействующегоВещества` CHAR, `Дозировка` CHAR, `Упаковка` INT, `ЛекарственнаяФорма` CHAR, `ЖНВЛП` BOOLEAN, `Изготовитель` CHAR, `НаименованиеМеждународное` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_partners` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `name_full` CHAR, `note` CHAR, `ДополнительноеОписание` CHAR, `ГоловнойКонтрагент` CHAR, `КодПоОКПО` CHAR, `ИНН` CHAR, `КПП` CHAR, `individual_legal` CHAR, `ОсновнойБанковскийСчет` CHAR, `main_contract` CHAR, `ДокументУдостоверяющийЛичность` CHAR, `ОсновнойМенеджерПокупателя` CHAR, `Покупатель` BOOLEAN, `Поставщик` BOOLEAN, `ОсновноеКонтактноеЛицо` CHAR, `Регион` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_contact_persons_partners` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `Должность` CHAR, `note` CHAR, `КонтактноеЛицо` CHAR, `owner` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_contact_persons` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `Фамилия` CHAR, `Имя` CHAR, `Отчество` CHAR, `ДатаРождения` Date, `definition` CHAR, `Пол` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_countries` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `name_full` CHAR, `КодАльфа2` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_units` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `name_full` CHAR, `МеждународноеСокращение` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_quality` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `cat_obj_categories` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `НазначениеКатегории` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_cashboxes` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `funds_currency` CHAR, `ПодразделениеОрганизации` CHAR, `owner` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_users_acl` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `prefix` CHAR, `owner` CHAR, `ts_acl_objs` JSON);\nCREATE TABLE IF NOT EXISTS `cat_meta_ids` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `ПорядокКоллекции` INT, `Имя` CHAR, `synonym` CHAR, `ПолноеИмя` CHAR, `ПолныйСиноним` CHAR, `БезДанных` BOOLEAN, `ЗначениеПустойСсылки` CHAR, `ЗначениеПустойСсылки_T` CHAR, `КлючОбъектаМетаданных` CHAR, `НоваяСсылка` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_property_values` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `owner` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_nom_units` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `qualifier_unit` CHAR, `Вес` FLOAT, `Объем` FLOAT, `coefficient` FLOAT, `ПорогОкругления` INT, `ПредупреждатьОНецелыхМестах` BOOLEAN, `owner` CHAR, `owner_T` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_contracts` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `settlements_currency` CHAR, `mutual_settlements` CHAR, `note` CHAR, `check_days_without_pay` BOOLEAN, `allowable_debts_amount` FLOAT, `allowable_debts_days` INT, `organization` CHAR, `check_debts_amount` BOOLEAN, `check_debts_days` BOOLEAN, `prepayment_percent` FLOAT, `price_type` CHAR, `price_type_T` CHAR, `contract_kind` CHAR, `ЧислоДнейРезерваБезОплаты` INT, `date` Date, `number_doc` CHAR, `main_project` CHAR, `main_project_T` CHAR, `main_cash_flow_article` CHAR, `СрокДействия` Date, `owner` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_nom_kinds` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `nom_type` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_contact_information_kinds` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `type` CHAR, `ВидОбъектаКонтактнойИнформации` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_currencies` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `name_full` CHAR, `ПараметрыПрописиНаРусском` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_bank_accounts` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `НомерСчета` CHAR, `Банк` CHAR, `БанкДляРасчетов` CHAR, `ТекстКорреспондента` CHAR, `ТекстНазначения` CHAR, `ВидСчета` CHAR, `funds_currency` CHAR, `НомерИДатаРазрешения` CHAR, `ДатаОткрытия` Date, `ДатаЗакрытия` Date, `МесяцПрописью` BOOLEAN, `СуммаБезКопеек` BOOLEAN, `ОтдельныйСчетГОЗ` BOOLEAN, `ГосударственныйКонтракт` CHAR, `owner` CHAR, `owner_T` CHAR);\nCREATE TABLE IF NOT EXISTS `cat_banks_qualifier` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `КоррСчет` CHAR, `Город` CHAR, `address` CHAR, `Телефоны` CHAR, `parent` CHAR);\nCREATE TABLE IF NOT EXISTS `cch_properties` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `НазначениеСвойства` CHAR, `type` JSON);\nCREATE TABLE IF NOT EXISTS `cch_predefined_elmnts` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `value` CHAR, `value_T` CHAR, `definition` CHAR, `synonym` CHAR, `Список` INT, `parent` CHAR, `type` CHAR, `ts_Элементы` JSON);\nCREATE TABLE IF NOT EXISTS `cch_destinations` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN, `parent` CHAR, `type` CHAR);\nCREATE TABLE IF NOT EXISTS `enm_individual_legal` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_users_types` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_nom_types` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_contact_information_types` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_vat_rates` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_obj_delivery_states` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_stores_kinds` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_costs_kinds` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_contract_kinds` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_mutual_contract_settlements` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\nCREATE TABLE IF NOT EXISTS `enm_accumulation_record_type` (ref CHAR PRIMARY KEY NOT NULL, `_deleted` BOOLEAN, id CHAR, name CHAR, is_folder BOOLEAN);\n"}),$p.on({settings:function(e,t){e.__define({local_storage_prefix:{value:"oo_"},skin:{value:"dhx_terrace"},pouch_filter:{value:function(){var e={};return e.__define({doc:{value:"auth/by_partner",writable:!1}}),e}(),writable:!1},guests:{value:[{username:"Алгоритм",password:"hQI7OhIGlVeOWi8="}]},irest_enabled:{value:!0},rest_path:{value:"/a/zd/%1/odata/standard.odata/"},keep_hash:{value:!0},guest_name:{value:"guest"},guest_pwd:{value:"meta"}}),e.zone=0,e.zone_demo=1,e.couch_path="/couchdb/oo_",e.enable_save_pwd=!0},iface_init:function(){$p.iface.sidebar_items=[{id:"orders",text:"Заказы",icon:"projects_48.png"},{id:"settings",text:"Настройки",icon:"settings_48.png"},{id:"about",text:"О программе",icon:"about_48.png"}],$p.iface.btn_auth_sync=new $p.iface.OBtnAuthSync,$p.iface.btns_nav=function(e){return $p.iface.btn_auth_sync.bind(new $p.iface.OTooolBar({wrapper:e,class_name:"md_otbnav",width:"260px",height:"28px",top:"3px",right:"3px",name:"right",buttons:[{name:"about",text:'<i class="fa fa-info-circle md-fa-lg"></i>',tooltip:"О программе","float":"right"},{name:"settings",text:'<i class="fa fa-cog md-fa-lg"></i>',tooltip:"Настройки","float":"right"},{name:"orders",text:'<i class="fa fa-suitcase md-fa-lg"></i>',tooltip:"Заказы","float":"right"},{name:"sep_0",text:"","float":"right"},{name:"sync",text:"","float":"right"},{name:"auth",text:"",width:"80px","float":"right"}],onclick:function(e){return $p.iface.main.cells(e).setActive(!0),!1}}))}},meta:function(){document.body.removeChild(document.querySelector("#osplash")),$p.iface.main=new dhtmlXSideBar({parent:document.body,icons_path:"dist/imgs/",width:180,header:!0,template:"tiles",autohide:!0,items:$p.iface.sidebar_items,offsets:{top:0,right:0,bottom:0,left:0}}),$p.iface.main.attachEvent("onSelect",function(e){var t=$p.job_prm.parse_url();t.view!=e&&$p.iface.set_hash(t.obj,t.ref,t.frm,e),$p.iface["view_"+e]($p.iface.main.cells(e))}),$p.iface.main.progressOn(),hprm=$p.job_prm.parse_url(),hprm.view&&$p.iface.main.getAllItems().indexOf(hprm.view)!=-1?setTimeout($p.iface.hash_route):$p.iface.set_hash(hprm.obj,hprm.ref,hprm.frm,"orders")},hash_route:function(e){return e.view&&$p.iface.main.getActiveItem()!=e.view&&$p.iface.main.getAllItems().forEach(function(t){t==e.view&&$p.iface.main.cells(t).setActive(!0)}),!1},predefined_elmnts_inited:function e(){$p.iface.main.progressOff(),$p.off(e),!$p.wsql.pouch.authorized&&navigator.onLine&&$p.wsql.get_user_param("enable_save_pwd")&&$p.wsql.get_user_param("user_name")&&$p.wsql.get_user_param("user_pwd")&&setTimeout(function(){$p.iface.frm_auth({modal_dialog:!0,try_auto:!0})},100)},pouch_load_data_error:function t(e){e.db_name&&e.hasOwnProperty("doc_count")&&e.doc_count<10&&navigator.onLine&&($p.wsql.set_user_param("enable_save_pwd",!0),$p.wsql.get_user_param("zone")!=$p.job_prm.zone_demo||$p.wsql.get_user_param("user_name")?$p.iface.frm_auth({modal_dialog:!0,try_auto:$p.wsql.get_user_param("zone")==$p.job_prm.zone_demo&&$p.wsql.get_user_param("enable_save_pwd")}):($p.wsql.set_user_param("user_name",$p.job_prm.guests[0].username),$p.wsql.set_user_param("user_pwd",$p.job_prm.guests[0].password),setTimeout(function(){$p.iface.frm_auth({modal_dialog:!0,try_auto:!0})},100))),$p.iface.main.progressOff(),$p.off(t)}}),$p.iface.view_about=function(e){function t(){e.attachHTMLString($p.injected_data["view_about.html"]),e.cell.querySelector(".dhx_cell_cont_sidebar").style.overflow="auto",
this.tb_nav=$p.iface.btns_nav(e.cell.querySelector(".dhx_cell_sidebar_hdr"))}return $p.iface._about||($p.iface._about=new t)},$p.iface.view_orders=function(e){function t(){function t(){i.carousel.cells("list").setActive(),e.setText({text:"Заказы"}),i.list||(i.carousel.cells("list").detachObject(!0),i.list=$p.doc.buyers_order.form_list(i.carousel.cells("list")))}function n(t){var n=i.carousel.cells("doc");n.setActive(),n.ref&&n.ref==t?i.doc&&i.doc.wnd&&setTimeout(i.doc.wnd.set_text.bind(i.doc.wnd,!0),200):$p.doc.buyers_order.form_obj(n,{ref:t,bind_pwnd:!0,on_close:function(){setTimeout(function(){$p.iface.set_hash(void 0,"","list")})},set_text:function(t){i.carousel.getActiveCell()==n&&e.setText({text:"<b>"+t+"</b>"})}}).then(function(e){i.doc=e,setTimeout(i.doc.wnd.set_text.bind(i.doc.wnd,!0),200)})}function a(e){return"orders"!=e.view||("doc.buyers_order"!=e.obj||$p.utils.is_empty_guid(e.ref)?"doc.buyers_order"!=e.obj?setTimeout(function(){$p.iface.set_hash("doc.buyers_order","","list")}):t():"doc"!=e.frm?setTimeout(function(){$p.iface.set_hash(void 0,void 0,"doc")}):n(e.ref),!1)}function r(){$p.off(r),setTimeout(function(){$p.iface.set_hash($p.job_prm.parse_url().obj||"doc.buyers_order")})}var i=this;i.tb_nav=$p.iface.btns_nav(e.cell.querySelector(".dhx_cell_sidebar_hdr")),i.carousel=e.attachCarousel({keys:!1,touch_scroll:!1,offset_left:0,offset_top:0,offset_item:0}),i.carousel.hideControls(),i.carousel.addCell("list"),i.carousel.addCell("doc"),$p.job_prm.properties?setTimeout(r):$p.on({predefined_elmnts_inited:r}),$p.on("hash_route",a)}return $p.iface._orders||($p.iface._orders=new t)},$p.iface.view_settings=function(e){function t(){var t=this;t.tb_nav=$p.iface.btns_nav(e.cell.querySelector(".dhx_cell_sidebar_hdr")),t.tabs=e.attachTabbar({arrows_mode:"auto",tabs:[{id:"const",text:'<i class="fa fa-key"></i> Общее',active:!0}]}),t.tabs.attachEvent("onSelect",function(e){return t[e]&&t[e].tree&&t[e].tree.getSelectedItemId()&&t[e].tree.callEvent("onSelect",[t[e].tree.getSelectedItemId()]),!0}),t.tabs.cells("const").attachHTMLString($p.injected_data["view_settings.html"]),t["const"]=t.tabs.cells("const").cell.querySelector(".dhx_cell_cont_tabbar"),t["const"].style.overflow="auto",function(e){t.form1=new dhtmlXForm(e,[{type:"settings",labelWidth:80,position:"label-left"},{type:"label",labelWidth:320,label:"Адрес CouchDB",className:"label_options"},{type:"input",inputWidth:220,name:"couch_path",label:"Путь:",validate:"NotEmpty"},{type:"template",label:"",value:"",note:{text:"Можно указать как относительный, так и абсолютный URL публикации CouchDB",width:320}},{type:"label",labelWidth:320,label:"Значение разделителя данных",className:"label_options"},{type:"input",inputWidth:220,name:"zone",label:"Зона:",numberFormat:["0","",""],validate:"NotEmpty,ValidInteger"},{type:"template",label:"",value:"",note:{text:"Для неразделенной публикации, зона = 0",width:320}},{type:"label",labelWidth:320,label:"Суффикс базы пользователя",className:"label_options"},{type:"input",inputWidth:220,name:"couch_suffix",label:"Суффикс:"},{type:"template",label:"",value:"",note:{text:"Назначается дилеру при регистрации",width:320}},{type:"label",labelWidth:320,label:"Сохранять пароль пользователя",className:"label_options"},{type:"checkbox",name:"enable_save_pwd",label:"Разрешить:",checked:$p.wsql.get_user_param("enable_save_pwd","boolean")},{type:"template",label:"",value:"",note:{text:"Не рекомендуется, если к компьютеру имеют доступ посторонние лица",width:320}},{type:"template",label:"",value:"",note:{text:"",width:320}},{type:"block",blockOffset:0,name:"block_buttons",list:[{type:"button",name:"save",value:"<i class='fa fa-floppy-o fa-lg'></i>",tooltip:"Применить настройки и перезагрузить программу"},{type:"newcolumn"},{type:"button",offsetLeft:20,name:"reset",value:"<i class='fa fa-refresh fa-lg'></i>",tooltip:"Стереть справочники и перезаполнить данными сервера"}]}]),t.form1.cont.style.fontSize="100%",["zone","couch_path","couch_suffix"].forEach(function(e){"zone"==e?t.form1.setItemValue(e,$p.wsql.get_user_param(e)):t.form1.setItemValue(e,$p.wsql.get_user_param(e)||$p.job_prm[e])}),t.form1.attachEvent("onChange",function(e,t,n){$p.wsql.set_user_param(e,"enable_save_pwd"==e?n||"":t)}),t.form1.attachEvent("onButtonClick",function(e){"save"==e?($p.wsql.pouch.log_out(),setTimeout(function(){$p.eve.redirect=!0,location.reload(!0)},1e3)):"reset"==e&&dhtmlx.confirm({title:"Сброс данных",text:"Стереть справочники и перезаполнить данными сервера?",cancel:$p.msg.cancel,callback:function(e){e&&$p.wsql.pouch.reset_local_data()}})})}(t["const"].querySelector("[name=form1]").firstChild),function(e){t.form2=new dhtmlXForm(e,[{type:"settings",labelWidth:320,position:"label-left"},{type:"label",label:"Тип устройства",className:"label_options"},{type:"block",blockOffset:0,name:"block_device_type",list:[{type:"settings",labelAlign:"left",position:"label-right"},{type:"radio",name:"device_type",labelWidth:120,label:'<i class="fa fa-desktop"></i> Компьютер',value:"desktop"},{type:"newcolumn"},{type:"radio",name:"device_type",labelWidth:150,label:'<i class="fa fa-mobile fa-lg"></i> Телефон, планшет',value:"phone"}]},{type:"template",label:"",value:"",note:{text:"Класс устройства определяется автоматически, но пользователь может задать его явно",width:320}},{type:"label",label:"Подключаемые модули",className:"label_options"},{type:"input",position:"label-top",inputWidth:320,name:"modifiers",label:"Модификаторы:",value:$p.wsql.get_user_param("modifiers"),rows:3,style:"height:80px;"},{type:"template",label:"",value:"",note:{text:"Список дополнительных модулей",width:320}}]),t.form2.cont.style.fontSize="100%",t.form2.checkItem("device_type",$p.job_prm.device_type),t.form2.disableItem("modifiers"),t.form2.attachEvent("onChange",function(e,t,n){$p.wsql.set_user_param(e,t)}),t.form2.getInput("modifiers").onchange=function(){$p.wsql.set_user_param("modifiers",this.value)}}(t["const"].querySelector("[name=form2]").firstChild)}return $p.iface._settings||($p.iface._settings=new t)}});